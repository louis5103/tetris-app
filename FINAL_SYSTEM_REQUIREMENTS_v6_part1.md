# FINAL_SYSTEM_REQUIREMENTS

**í”„ë¡œì íŠ¸**: Tetris Multi-Module Architecture  
**ë²„ì „**: 6.0 (Production Ready - ìµœì¢… ì ê²€ ì™„ë£Œ)  
**ì‘ì„±ì¼**: 2025-11-06  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-06  
**ìŠ¹ì¸ ìƒíƒœ**: âœ… ìµœì¢… ìŠ¹ì¸ (í”„ë¡œë•ì…˜ ê°œë°œ ì‹œì‘ ê°€ëŠ¥)  
**ëª©ì **: Spring Boot ê¸°ë°˜ ì•„í‚¤í…ì²˜ êµ¬ì¶• ë° ë””ìì¸ íŒ¨í„´ ì ìš©

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ (Requirements)](#1-ì‹œìŠ¤í…œ-ìš”êµ¬ì‚¬í•­-requirements)
2. [ë³€ê²½ íŒŒì¼ ëª©ë¡ (Change List)](#2-ë³€ê²½-íŒŒì¼-ëª©ë¡-change-list)
3. [ì•„í‚¤í…ì²˜ ì„¤ê³„ (Architecture)](#3-ì•„í‚¤í…ì²˜-ì„¤ê³„-architecture)
4. [ë””ìì¸ íŒ¨í„´ ì ìš© (Design Patterns)](#4-ë””ìì¸-íŒ¨í„´-ì ìš©-design-patterns)
5. [ë©€í‹°í”Œë ˆì´ì–´ í†µì‹  (Multiplayer)](#5-ë©€í‹°í”Œë ˆì´ì–´-í†µì‹ -multiplayer)
6. [UI ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ (UI Events)](#6-ui-ì´ë²¤íŠ¸-ì‹œìŠ¤í…œ-ui-events)
7. [ëª¨ë“ˆë³„ ìƒì„¸ êµ¬í˜„ (Implementation)](#7-ëª¨ë“ˆë³„-ìƒì„¸-êµ¬í˜„-implementation)
8. [Spring Boot ì„¤ì • (Configuration)](#8-spring-boot-ì„¤ì •-configuration)
9. [ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸ (Verification)](#9-ê²€ì¦-ì²´í¬ë¦¬ìŠ¤íŠ¸-verification)
10. [ì„¤ê³„ ê²°ì • ë° íŠ¸ë ˆì´ë“œì˜¤í”„ (Design Decisions)](#10-ì„¤ê³„-ê²°ì •-ë°-íŠ¸ë ˆì´ë“œì˜¤í”„-design-decisions)
11. [ìœ„í—˜ ê´€ë¦¬ (Risk Management)](#11-ìœ„í—˜-ê´€ë¦¬-risk-management)
12. [ë°°í¬ ì „ëµ (Deployment)](#12-ë°°í¬-ì „ëµ-deployment)

**ë¶€ë¡**
- [ë¶€ë¡ A: êµ¬í˜„ ìš°ì„ ìˆœìœ„](#ë¶€ë¡-a-êµ¬í˜„-ìš°ì„ ìˆœìœ„)
- [ë¶€ë¡ B: ì²´í¬ë¦¬ìŠ¤íŠ¸](#ë¶€ë¡-b-ì²´í¬ë¦¬ìŠ¤íŠ¸)
- [ë¶€ë¡ C: ìš©ì–´ì§‘](#ë¶€ë¡-c-ìš©ì–´ì§‘-glossary)
- [ë¶€ë¡ D: ì°¸ì¡° ë¬¸ì„œ](#ë¶€ë¡-d-ì°¸ì¡°-ë¬¸ì„œ-references)
- [ë¶€ë¡ E: FAQ](#ë¶€ë¡-e-faq)

---

## 1. ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ (Requirements)

### 1.0 ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ (User Requirements)

#### UR-1: ì‚¬ìš©ì ê²½í—˜ ìš”êµ¬ì‚¬í•­
- **UR-1.1**: ê²Œì„ ì‹œì‘ ì‹œê°„
  - **ìš”êµ¬ì‚¬í•­**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ í›„ 3ì´ˆ ì´ë‚´ ë©”ì¸ ë©”ë‰´ í‘œì‹œ
  - **ì¸¡ì •**: ë¡œë”© í™”ë©´ë¶€í„° ë©”ì¸ ë©”ë‰´ê¹Œì§€ ì‹œê°„
  - **ê·¼ê±°**: ì‚¬ìš©ì ì´íƒˆ ë°©ì§€
  
- **UR-1.2**: ì¡°ì‘ ë°˜ì‘ ì†ë„
  - **ìš”êµ¬ì‚¬í•­**: í‚¤ ì…ë ¥ í›„ 50ms ì´ë‚´ í™”ë©´ ë°˜ì˜
  - **ì¸¡ì •**: í‚¤ ì´ë²¤íŠ¸ë¶€í„° í™”ë©´ ê°±ì‹ ê¹Œì§€ ì‹œê°„
  - **ê·¼ê±°**: í…ŒíŠ¸ë¦¬ìŠ¤ëŠ” ë¹ ë¥¸ ë°˜ì‘ì´ í•„ìˆ˜
  
- **UR-1.3**: ê²Œì„ ê·œì¹™ ëª…í™•ì„±
  - **ìš”êµ¬ì‚¬í•­**: ì²˜ìŒ í”Œë ˆì´í•˜ëŠ” ì‚¬ìš©ìë„ 5ë¶„ ì´ë‚´ ì´í•´ ê°€ëŠ¥
  - **êµ¬í˜„**: íŠœí† ë¦¬ì–¼ ëª¨ë“œ ì œê³µ, í‚¤ ì¡°ì‘ ê°€ì´ë“œ í‘œì‹œ
  - **ê·¼ê±°**: ì§„ì… ì¥ë²½ ë‚®ì¶”ê¸°
  
- **UR-1.4**: ì ‘ê·¼ì„± (Accessibility)
  - **ìš”êµ¬ì‚¬í•­**: ìƒ‰ë§¹ ì‚¬ìš©ìë¥¼ ìœ„í•œ ìƒ‰ìƒ ì˜µì…˜ ì œê³µ
  - **êµ¬í˜„**: ê³ ëŒ€ë¹„ ëª¨ë“œ, íŒ¨í„´/ê¸°í˜¸ë¡œ ë¸”ë¡ êµ¬ë¶„
  - **ê·¼ê±°**: WCAG 2.1 ë ˆë²¨ AA ì¤€ìˆ˜

#### UR-2: ê²Œì„ ë°¸ëŸ°ìŠ¤ ìš”êµ¬ì‚¬í•­
- **UR-2.1**: ë‚œì´ë„ ê³¡ì„ 
  - **ìš”êµ¬ì‚¬í•­**: ë ˆë²¨ 1 â†’ 10ê¹Œì§€ ì ì§„ì  ë‚œì´ë„ ì¦ê°€
  - **êµ¬í˜„**: 
    - ë ˆë²¨ 1-3: ì´ˆë³´ì (ë‚™í•˜ ì†ë„ 1ì´ˆ/ì¹¸)
    - ë ˆë²¨ 4-7: ì¤‘ê¸‰ì (ë‚™í•˜ ì†ë„ 0.5ì´ˆ/ì¹¸)
    - ë ˆë²¨ 8-10: ê³ ê¸‰ì (ë‚™í•˜ ì†ë„ 0.2ì´ˆ/ì¹¸)
  - **ê·¼ê±°**: Flow Theory (ëª°ì… ìƒíƒœ ìœ ì§€)
  
- **UR-2.2**: ì ìˆ˜ ì‹œìŠ¤í…œ ê³µì •ì„±
  - **ìš”êµ¬ì‚¬í•­**: ë†’ì€ ë‚œì´ë„ì¼ìˆ˜ë¡ ë†’ì€ ì ìˆ˜ íšë“ (SRS í‘œì¤€ ì¤€ìˆ˜)
  - **êµ¬í˜„**: 
    - EASY: 0.5x ì ìˆ˜ (ì´ˆë³´ì ì¹œí™”ì )
    - NORMAL: 1.0x ì ìˆ˜ (ê¸°ë³¸ ë°°ìœ¨)
    - HARD: 1.5x ì ìˆ˜ (ìˆ™ë ¨ì ë³´ìƒ)
    - EXPERT: 2.0x ì ìˆ˜ (ì „ë¬¸ê°€ ë³´ìƒ)
  - **ê·¼ê±°**: ë…¸ë ¥ê³¼ ì‹¤ë ¥ì— ëŒ€í•œ ì •ë‹¹í•œ ë³´ìƒ (ì—…ê³„ í‘œì¤€)
  
- **UR-2.3**: ì•„ì´í…œ ë°¸ëŸ°ìŠ¤ (Arcade ëª¨ë“œ)
  - **ìš”êµ¬ì‚¬í•­**: ì•„ì´í…œì´ ê²Œì„ í”Œë ˆì´ë¥¼ ì§€ë°°í•˜ì§€ ì•ŠìŒ
  - **ì œì•½ì‚¬í•­**: 
    - ì•„ì´í…œ ë“œë¡­ í™•ë¥  ìµœëŒ€ 30% (ê²Œì„ ë°¸ëŸ°ìŠ¤ ìœ ì§€)
    - ë™ì¼ ì•„ì´í…œ ì—°ì† íšë“ í™•ë¥  ê°ì†Œ
  - **êµ¬í˜„**: 0.0 ~ 0.3 ë²”ìœ„ ì œí•œ (FR-4.1 ì°¸ì¡°)
  - **ê·¼ê±°**: ì‹¤ë ¥ ê¸°ë°˜ ê²Œì„ ìœ ì§€

#### UR-3: ë©€í‹°í”Œë ˆì´ì–´ ìš”êµ¬ì‚¬í•­
- **UR-3.1**: ë§¤ì¹­ ì‹œê°„
  - **ìš”êµ¬ì‚¬í•­**: 30ì´ˆ ì´ë‚´ ìƒëŒ€ ë§¤ì¹­
  - **ì‹¤íŒ¨ ì‹œ**: ë´‡ ë§¤ì¹­ ë˜ëŠ” ì‹±ê¸€ í”Œë ˆì´ ì „í™˜ ì œì•ˆ
  - **ê·¼ê±°**: ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„ ìµœì†Œí™”
  
- **UR-3.2**: ê³µì •í•œ ê²½ìŸ í™˜ê²½
  - **ìš”êµ¬ì‚¬í•­**: 
    - ë™ì¼í•œ ë¸”ë¡ ìˆœì„œ ì œê³µ (ì„ íƒì‚¬í•­)
    - RTT 100ms ì´ìƒ ì°¨ì´ ì‹œ í•¸ë””ìº¡ ì œê³µ
  - **êµ¬í˜„**: ì„œë²„ì—ì„œ ì‹œë“œê°’ ë™ê¸°í™”
  - **ê·¼ê±°**: ê³µì •í•œ ê²½ìŸ
  
- **UR-3.3**: í†µì‹  ëŠê¹€ ì²˜ë¦¬
  - **ìš”êµ¬ì‚¬í•­**: ìƒëŒ€ë°© ì ‘ì† ëŠê¹€ ì‹œ 5ì´ˆ ëŒ€ê¸° í›„ ìŠ¹ë¦¬ ì²˜ë¦¬
  - **ì•Œë¦¼**: "ìƒëŒ€ë°©ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì ì‹œ í›„ ìŠ¹ë¦¬ ì²˜ë¦¬ë©ë‹ˆë‹¤."
  - **ê·¼ê±°**: ëª…í™•í•œ ê²Œì„ ì¢…ë£Œ ê·œì¹™

#### UR-4: ë°ì´í„° ì˜ì†ì„± ìš”êµ¬ì‚¬í•­
- **UR-4.1**: ë¡œì»¬ ê¸°ë¡ ì €ì¥
  - **ìš”êµ¬ì‚¬í•­**: ì‹±ê¸€ í”Œë ˆì´ ìµœê³  ì ìˆ˜ ë¡œì»¬ ì €ì¥
  - **ë³´ê´€ ê¸°ê°„**: ì˜êµ¬ (ì‚­ì œ ì „ê¹Œì§€)
  - **íŒŒì¼ ìœ„ì¹˜**: `~/.tetris/local_scores.json`
  
- **UR-4.2**: ì„œë²„ ê¸°ë¡ ë™ê¸°í™”
  - **ìš”êµ¬ì‚¬í•­**: ë©€í‹° í”Œë ˆì´ ê¸°ë¡ ì„œë²„ ì €ì¥ + ìˆœìœ„í‘œ ì œê³µ
  - **ë™ê¸°í™”**: ê²Œì„ ì¢…ë£Œ ì‹œ ì¦‰ì‹œ ì „ì†¡
  - **ì‹¤íŒ¨ ì‹œ**: ì¬ì‹œë„ 3íšŒ, ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ì €ì¥ í›„ ë‚˜ì¤‘ì— ì¬ì „ì†¡
  
- **UR-4.3**: ê°œì¸ì •ë³´ ë³´í˜¸
  - **ìš”êµ¬ì‚¬í•­**: ì‚¬ìš©ì ì´ë¦„ë§Œ ì €ì¥ (ê°œì¸ ì‹ë³„ ì •ë³´ ì œì™¸)
  - **ì¤€ìˆ˜**: GDPR, ê°œì¸ì •ë³´ë³´í˜¸ë²•
  - **ì‚­ì œ ê¶Œë¦¬**: ì‚¬ìš©ì ìš”ì²­ ì‹œ ëª¨ë“  ê¸°ë¡ ì‚­ì œ ê°€ëŠ¥

#### UR-5: ìš´ì˜ ìš”êµ¬ì‚¬í•­
- **UR-5.1**: ì‹œìŠ¤í…œ ê°€ìš©ì„±
  - **ìš”êµ¬ì‚¬í•­**: 99.5% ì´ìƒ ê°€ë™ë¥  (ì›” 3.6ì‹œê°„ ì´ë‚´ ë‹¤ìš´íƒ€ì„)
  - **ì¸¡ì •**: ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨ìœ¨, ì ‘ì† ì„±ê³µë¥ 
  - **ê·¼ê±°**: ì„œë¹„ìŠ¤ ì‹ ë¢°ì„±
  
- **UR-5.2**: ë°±ì—… ë° ë³µêµ¬
  - **ìš”êµ¬ì‚¬í•­**: 
    - ë°ì´í„°ë² ì´ìŠ¤ ì¼ì¼ ë°±ì—…
    - ë³µêµ¬ ì‹œê°„ ëª©í‘œ(RTO): 1ì‹œê°„ ì´ë‚´
    - ë³µêµ¬ ì‹œì  ëª©í‘œ(RPO): 24ì‹œê°„ ì´ë‚´
  - **êµ¬í˜„**: ìë™í™”ëœ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸, S3 ì €ì¥
  
- **UR-5.3**: ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼
  - **ìš”êµ¬ì‚¬í•­**: 
    - ì„œë²„ CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§
    - ì—ëŸ¬ìœ¨ 1% ì´ˆê³¼ ì‹œ ì•Œë¦¼
    - ì‘ë‹µ ì‹œê°„ 500ms ì´ˆê³¼ ì‹œ ì•Œë¦¼
  - **êµ¬í˜„**: Prometheus + Grafana + Alertmanager
  
- **UR-5.4**: ë¡œê·¸ ë³´ê´€
  - **ìš”êµ¬ì‚¬í•­**: 
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ 90ì¼ ë³´ê´€
    - ì ‘ì† ë¡œê·¸ 30ì¼ ë³´ê´€
    - ë³´ì•ˆ ë¡œê·¸ 1ë…„ ë³´ê´€
  - **êµ¬í˜„**: Logrotate, S3 ì•„ì¹´ì´ë¹™

### 1.1 ê¸°ìˆ  ìŠ¤íƒ (ì •í™•í•œ ë²„ì „ ëª…ì‹œ)

#### í•„ìˆ˜ ì˜ì¡´ì„±
- **ì–¸ì–´**: Java 21 LTS (ìµœì†Œ 21.0.1)
- **í”„ë ˆì„ì›Œí¬**: Spring Boot 3.2.0 ì´ìƒ
- **ë¹Œë“œ ë„êµ¬**: Gradle 8.5 ì´ìƒ
- **ì˜ì¡´ì„± ì£¼ì…**: Spring DI (@Autowired, @Configuration)
- **ì•„í‚¤í…ì²˜**: Multi-Module (tetris-core, tetris-client, tetris-backend)

#### í†µì‹  ë° ë„¤íŠ¸ì›Œí‚¹
- **REST API**: Spring Web MVC
- **WebSocket**: Spring WebSocket 6.1.0 ì´ìƒ
- **HTTP Client**: Spring WebClient (reactive)

#### ë™ì‹œì„± ë° ì„±ëŠ¥
- **ë™ì‹œì„±**: java.util.concurrent (AtomicBoolean, AtomicInteger, ConcurrentHashMap)
- **ìŠ¤ì¼€ì¤„ë§**: ScheduledExecutorService

#### ë³´ì•ˆ
- **í”„ë ˆì„ì›Œí¬**: Spring Security 6.2.0 ì´ìƒ
- **ì¸ì¦**: JWT (jjwt 0.12.0 ì´ìƒ)
- **ì•”í˜¸í™”**: BCrypt

#### ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…
- **ë©”íŠ¸ë¦­**: Micrometer 1.12.0 ì´ìƒ
- **ë©”íŠ¸ë¦­ ìˆ˜ì§‘**: Prometheus
- **ëŒ€ì‹œë³´ë“œ**: Grafana 10.0 ì´ìƒ
- **ë¡œê¹…**: Logback (Spring Boot ê¸°ë³¸)

#### ë°ì´í„°ë² ì´ìŠ¤ (Backend)
- **RDBMS**: MySQL 8.0 ì´ìƒ
- **ORM**: Spring Data JPA
- **Connection Pool**: HikariCP

#### í…ŒìŠ¤íŠ¸
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: JUnit 5.10.0 ì´ìƒ
- **Mocking**: Mockito 5.5.0 ì´ìƒ
- **í†µí•© í…ŒìŠ¤íŠ¸**: Spring Boot Test
- **ì»¨í…Œì´ë„ˆ**: TestContainers 1.19.0 ì´ìƒ
- **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: JMeter 5.6 ë˜ëŠ” Gatling 3.10
- **UI í…ŒìŠ¤íŠ¸**: TestFX 4.0.18 (JavaFX)

#### UI (Client)
- **GUI**: JavaFX 21

---

### 1.2 ëª¨ë“ˆ êµ¬ì¡° ì›ì¹™

#### M-1: tetris-core (Core Game Logic)
- **M-1.1**: Spring ì˜ì¡´ì„± í¬í•¨ ê°€ëŠ¥ (ì„¤ì • ë¡œë“œ ì œì™¸)
  - **í—ˆìš©**: @Component, @Service, @Autowired
  - **ê¸ˆì§€**: @ConfigurationProperties, application.yml ë¡œë“œ
- **M-1.2**: ê²Œì„ ë¡œì§ë§Œ í¬í•¨ (UI, ë„¤íŠ¸ì›Œí¬ ì œì™¸)
  - **í¬í•¨**: GameEngine, GameState, ItemManager, Tetromino
  - **ì œì™¸**: JavaFX, REST Client, WebSocket
- **M-1.3**: Spring Beanìœ¼ë¡œ ë“±ë¡ ê°€ëŠ¥
  - **ë°©ì‹**: @Component ìŠ¤ìº” ë˜ëŠ” @Configurationì—ì„œ @Bean ë“±ë¡
- **M-1.4**: application.ymlì€ Clientì—ì„œë§Œ ë¡œë“œ
  - **ì´ìœ **: ì„¤ì •ì€ ì‹¤í–‰ í™˜ê²½ì— ë”°ë¼ ë‹¤ë¦„ (Client vs Server)
- **M-1.5**: âœ… **GameEngineì€ Interfaceë¡œ êµ¬í˜„** (ë‹¤í˜•ì„± ì§€ì›)
  - **ì´ìœ **: Classic/Arcade ëª¨ë“œë¥¼ ë‹¤í˜•ì„±ìœ¼ë¡œ ì²˜ë¦¬
  - **êµ¬í˜„**: ClassicGameEngine, ArcadeGameEngine
- **M-1.6**: âœ… **GameStateëŠ” ë¶ˆë³€ ê°ì²´** (@Value ì‚¬ìš©)
  - **ì´ìœ **: ë™ì‹œì„± ì•ˆì •ì„±, State Reconciliation ìš©ì´
  - **êµ¬í˜„**: Lombok @Value + @Builder(toBuilder = true)

#### M-2: tetris-client (Spring Boot + JavaFX)
- **M-2.1**: Spring Boot DI ì»¨í…Œì´ë„ˆ ì‚¬ìš©
  - **ì´ˆê¸°í™”**: SpringApplication.run()
  - **JavaFX í†µí•©**: Platform.startup()
- **M-2.2**: @ConfigurationPropertiesë¡œ ì„¤ì • ë¡œë“œ
  - **íŒŒì¼**: application.yml
  - **í´ë˜ìŠ¤**: TetrisGameConfig, NetworkConfig
- **M-2.3**: tetris-coreë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì‚¬ìš©
  - **ë°©ì‹**: Gradle implementation 'project(:tetris-core)'
- **M-2.4**: @Configurationìœ¼ë¡œ Bean ë“±ë¡
  - **í´ë˜ìŠ¤**: GameEngineConfig, GameModeConfig, NetworkConfig
- **M-2.5**: âœ… **ëª¨ë“  ë™ì‹œì„± ì»´í¬ë„ŒíŠ¸ëŠ” Thread-safe** (AtomicBoolean/Integer ì‚¬ìš©)
  - **ëŒ€ìƒ**: UIEventHandler, MultiPlayStrategy, NetworkServiceProxy
  - **êµ¬í˜„**: AtomicBoolean, AtomicInteger, synchronized
- **M-2.6**: âœ… **ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ê¸° êµ¬í˜„ í•„ìˆ˜** (@ControllerAdvice)
  - **í´ë˜ìŠ¤**: GlobalExceptionHandler
  - **ì²˜ë¦¬**: NetworkException, ValidationException, StateConflictException

#### M-3: tetris-backend (Spring Boot REST API)
- **M-3.1**: REST API ì„œë²„
  - **í”„ë ˆì„ì›Œí¬**: Spring Web MVC
  - **ì—”ë“œí¬ì¸íŠ¸**: /api/game/*, /api/auth/*
- **M-3.2**: MySQL ì—°ë™
  - **ORM**: Spring Data JPA
  - **Entity**: Player, GameSession, Score
- **M-3.3**: Server Authoritative ê²Œì„ ë¡œì§
  - **ì›ì¹™**: ëª¨ë“  ê²Œì„ ìƒíƒœëŠ” ì„œë²„ê°€ ìµœì¢… ê²°ì •
  - **ê²€ì¦**: Command ìœ íš¨ì„±, Cheating Detection
- **M-3.4**: WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ Push
  - **ìš©ë„**: Critical Events, Attack Events
  - **í”„ë¡œí† ì½œ**: STOMP over WebSocket
- **M-3.5**: âœ… **JWT ì¸ì¦ í•„ìˆ˜**
  - **í•„í„°**: JwtAuthenticationFilter
  - **ê²€ì¦**: ëª¨ë“  API ìš”ì²­ì— í† í° í•„ìš”
- **M-3.6**: âœ… **Rate Limiting êµ¬í˜„ í•„ìˆ˜**
  - **ì¸í„°ì…‰í„°**: RateLimitingInterceptor
  - **ì œí•œ**: 100 req/min per player
- **M-3.7**: âœ… **Cheating Detection êµ¬í˜„**
  - **ì„œë¹„ìŠ¤**: CheatDetectionService
  - **ê²€ì¦**: ì ìˆ˜ ì¦ê°€ìœ¨, ë¼ì¸ í´ë¦¬ì–´ ì†ë„

---

### 1.3 ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

#### FR-1: ëª¨ë“œ ì¡°í•© ì§€ì› (ë‘ ì¶• ë¶„ë¦¬)
- **FR-1.1**: **Axis 1 - PlayType** (í”Œë ˆì´ ë°©ì‹)
  - **LOCAL_SINGLE**: ì‹±ê¸€ í”Œë ˆì´
    - ì„œë²„ í†µì‹  ì—†ìŒ
    - ë¡œì»¬ì—ì„œ ëª¨ë“  ë¡œì§ ì‹¤í–‰
  - **ONLINE_MULTI**: ëŒ€ì „ í”Œë ˆì´
    - ì„œë²„ í†µì‹  í•„ìš”
    - Server Authoritative
    
- **FR-1.2**: **Axis 2 - GameplayType** (ê²Œì„ ê·œì¹™)
  - **CLASSIC**: ê¸°ë³¸ í…ŒíŠ¸ë¦¬ìŠ¤
    - í‘œì¤€ í…ŒíŠ¸ë¡œë¯¸ë…¸ (7ì¢…)
    - í‘œì¤€ ì ìˆ˜ ê³„ì‚°
  - **ARCADE**: ì•„ì´í…œ í…ŒíŠ¸ë¦¬ìŠ¤
    - ì•„ì´í…œ ë¸”ë¡ ì¶”ê°€
    - íŠ¹ìˆ˜ íš¨ê³¼
    
- **FR-1.3**: 4ê°€ì§€ ì¡°í•© ì§€ì›
  - **Single + Classic**: ê¸°ë³¸ ì‹±ê¸€ í”Œë ˆì´
  - **Single + Arcade**: ì•„ì´í…œ ì‹±ê¸€ í”Œë ˆì´
  - **Multi + Classic**: ëŒ€ì „ í…ŒíŠ¸ë¦¬ìŠ¤
  - **Multi + Arcade**: ì•„ì´í…œ ëŒ€ì „

- **FR-1.4**: ì¡°í•© ì„ íƒ ë°©ì‹
  - **ì„¤ì • íŒŒì¼**: application.ymlì—ì„œ PlayType ì„¤ì •
  - **ëŸ°íƒ€ì„**: GameplayTypeì€ ë©”ë‰´ì—ì„œ ì„ íƒ ê°€ëŠ¥

#### FR-2: ë©€í‹°í”Œë ˆì´ì–´ Command ì „ì†¡
- **FR-2.1**: ëª¨ë“  ì‚¬ìš©ì ì…ë ¥ì„ ì„œë²„ì— ì „ì†¡
  - **ì´ë™**: MOVE_LEFT, MOVE_RIGHT, SOFT_DROP
  - **íšŒì „**: ROTATE_CW, ROTATE_CCW
  - **íŠ¹ìˆ˜**: HARD_DROP, HOLD
  - **ì•„ì´í…œ**: USE_ITEM (Arcade ëª¨ë“œ)
  
- **FR-2.2**: Client-Side Prediction (ì¦‰ì‹œ ë°˜ì‘)
  - **ëª©ì **: ë„¤íŠ¸ì›Œí¬ ì§€ì—° ìˆ¨ê¸°ê¸°
  - **êµ¬í˜„**: ì„œë²„ ì „ì†¡ ì „ ë¡œì»¬ì—ì„œ ë¨¼ì € ì‹¤í–‰
  - **íš¨ê³¼**: ì‚¬ìš©ìëŠ” ì¦‰ì‹œ ë°˜ì‘ ëŠë‚Œ
  
- **FR-2.3**: Server Authoritative (ì„œë²„ ê²€ì¦)
  - **ì›ì¹™**: ì„œë²„ ì‘ë‹µì´ ìµœì¢… ì§„ì‹¤
  - **ê²€ì¦**: ì„œë²„ì—ì„œ ëª¨ë“  Command ì¬ì‹¤í–‰
  - **ë³´ì•ˆ**: ì¹˜íŒ… ë°©ì§€
  
- **FR-2.4**: State Reconciliation (ì„œë²„ ìƒíƒœë¡œ ë³´ì •)
  - **ë¹„êµ**: ë¡œì»¬ ì˜ˆì¸¡ vs ì„œë²„ ì‘ë‹µ
  - **ë¶ˆì¼ì¹˜**: ì„œë²„ ìƒíƒœë¡œ ê°•ì œ ë™ê¸°í™”
  - **ì¬ì‹¤í–‰**: ë¯¸ì²˜ë¦¬ Pending Commands
  
- **FR-2.5**: âœ… **Command Throttling** (16ms ê°„ê²©, 60 FPS)
  - **ì œì•½ì‚¬í•­**: ë™ì¼ íƒ€ì… CommandëŠ” 16ms ê°„ê²©ìœ¼ë¡œë§Œ ì „ì†¡
  - **êµ¬í˜„**: MultiPlayStrategyì—ì„œ lastSentTime ì²´í¬
  - **ëª©ì **: ì„œë²„ ë¶€í•˜ ë°©ì§€
    - ì˜ˆì‹œ: 100ëª… ì ‘ì† ì‹œ
      - Throttling ì „: 6,000 req/s (ê°ì 60 req/s)
      - Throttling í›„: 375 req/s (ê°ì 3.75 req/s)

#### FR-3: UI ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ (Hybrid ë°©ì‹)
- **FR-3.1**: Critical Events - ì„œë²„ ìƒì„±
  - **ì ìˆ˜ ê´€ë ¨**: LINE_CLEAR, T_SPIN, COMBO, PERFECT_CLEAR
  - **ê²Œì„ ì§„í–‰**: LEVEL_UP, GAME_OVER
  - **ë©€í‹°í”Œë ˆì´**: ATTACK_SENT, ATTACK_RECEIVED
  - **íŠ¹ì§•**: 
    - ì„œë²„ì—ì„œë§Œ ìƒì„±
    - ì ìˆ˜ ê³„ì‚° í¬í•¨
    - ì¼ê´€ì„± ë³´ì¥
    
- **FR-3.2**: Local Events - í´ë¼ì´ì–¸íŠ¸ ìƒì„±
  - **ë¸”ë¡ ì¡°ì‘**: BLOCK_MOVE, BLOCK_ROTATE, BLOCK_LOCK
  - **UI íš¨ê³¼**: GHOST_PIECE_UPDATE, HOLD_SWAP
  - **íŠ¹ì§•**:
    - ì¦‰ì‹œ ìƒì„± (<50ms)
    - ì‹œê° í”¼ë“œë°± ìš©ë„
    - ì ìˆ˜ ê³„ì‚° ì—†ìŒ
    
- **FR-3.3**: ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìˆœì°¨ í‘œì‹œ
  - **ìš°ì„ ìˆœìœ„**: PERFECT_CLEAR(16) > LINE_CLEAR(15) > T_SPIN(14) > ...
  - **ìˆœì°¨ ì‹¤í–‰**: Priority Queueë¡œ ì •ë ¬ í›„ í•˜ë‚˜ì”© í‘œì‹œ
  - **duration**: ê° ì´ë²¤íŠ¸ë§ˆë‹¤ í‘œì‹œ ì‹œê°„ ì„¤ì •
  
- **FR-3.4**: GameState + Events í•¨ê»˜ ì „ì†¡
  - **Response êµ¬ì¡°**:
    ```json
    {
      "state": {...},
      "events": [...]
    }
    ```
  - **ì´ìœ **: ìƒíƒœì™€ ì´ë²¤íŠ¸ì˜ ì¼ê´€ì„± ë³´ì¥
  
- **FR-3.5**: âœ… **UIEventHandlerëŠ” Thread-safe í•„ìˆ˜**
  - **êµ¬í˜„ ì¡°ê±´**: 
    - AtomicBoolean isProcessing
    - synchronized (lock) { eventQueue.addAll() }
    - CAS íŒ¨í„´: compareAndSet(false, true)
  - **ì œì•½ì‚¬í•­**: Race Condition ë°©ì§€

#### FR-4: ì•„ì´í…œ ì‹œìŠ¤í…œ (Arcade ëª¨ë“œ)
- **FR-4.1**: ì•„ì´í…œ ë“œë¡­ í™•ë¥  ì„¤ì • ê°€ëŠ¥
  - **ì„¤ì •**: application.ymlì—ì„œ drop-rate ì¡°ì •
  - **ë²”ìœ„**: 0.0 ~ 0.3 (0% ~ 30%) - ê²Œì„ ë°¸ëŸ°ìŠ¤ ì œì•½ (UR-2.3)
  - **ê¸°ë³¸ê°’**: 0.15 (15%)
  - **ê·¼ê±°**: ì•„ì´í…œì´ ê²Œì„ì„ ì§€ë°°í•˜ì§€ ì•Šë„ë¡ ìµœëŒ€ê°’ ì œí•œ
  
- **FR-4.2**: í™œì„±í™” ì•„ì´í…œ ì„ íƒ ê°€ëŠ¥
  - **ì„¤ì •**: enabled-items ë¦¬ìŠ¤íŠ¸
  - **ì„ íƒ**: ì›í•˜ëŠ” ì•„ì´í…œë§Œ í™œì„±í™”
  
- **FR-4.3**: ì•„ì´í…œ íš¨ê³¼ ì ìš©
  - **BOMB**: ì£¼ë³€ ë¸”ë¡ ì œê±° (3x3 ì˜ì—­)
  - **PLUS_ONE_LINE**: ìƒëŒ€ì—ê²Œ 1ì¤„ ì¶”ê°€
  - **SPEED_RESET**: ë‚™í•˜ ì†ë„ ì´ˆê¸°í™”
  - **BONUS_SCORE**: ë³´ë„ˆìŠ¤ ì ìˆ˜ (+1000)
  
- **FR-4.4**: ì•„ì´í…œ ë¸”ë¡ì€ 1ì¹¸ì§œë¦¬ íŠ¹ìˆ˜ í…ŒíŠ¸ë¡œë¯¸ë…¸
  - **í¬ê¸°**: 1x1
  - **ì´ë™**: ì¼ë°˜ í…ŒíŠ¸ë¡œë¯¸ë…¸ì²˜ëŸ¼ ì´ë™ ê°€ëŠ¥
  - **íšë“**: ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ìë™ íšë“
  
- **FR-4.5**: ì•„ì´í…œ ë¸”ë¡ì€ Hold ë¶ˆê°€
  - **ì œì•½**: HOLD Command ê±°ë¶€
  - **ì´ìœ **: ê²Œì„ ë°¸ëŸ°ìŠ¤

#### FR-5: ë‚œì´ë„ ì‹œìŠ¤í…œ
- **FR-5.1**: ë‚œì´ë„ë³„ í…ŒíŠ¸ë¡œë¯¸ë…¸ ìƒì„± í™•ë¥  ë³€ê²½
  - **EASY**: ê· ë“± ë¶„í¬
  - **NORMAL**: ì•½ê°„ ë¶ˆê· ë“±
  - **HARD**: ë¶ˆë¦¬í•œ ë¸”ë¡ ë†’ì€ í™•ë¥ 
  - **EXPERT**: ë§¤ìš° ë¶ˆë¦¬í•œ ë¸”ë¡
  
- **FR-5.2**: ë‚œì´ë„ë³„ ì ìˆ˜ ë°°ìœ¨ ì ìš© (SRS í‘œì¤€)
  - **EASY**: 0.5x (ì´ˆë³´ì ë°°ìœ¨)
  - **NORMAL**: 1.0x (ê¸°ì¤€ ë°°ìœ¨)
  - **HARD**: 1.5x (ìˆ™ë ¨ì ë°°ìœ¨)
  - **EXPERT**: 2.0x (ì „ë¬¸ê°€ ë°°ìœ¨)
  - **ê·¼ê±°**: ë†’ì€ ë‚œì´ë„ = ë†’ì€ ë³´ìƒ (ì—…ê³„ í‘œì¤€ ì›ì¹™)
  
- **FR-5.3**: ë‚œì´ë„: EASY, NORMAL, HARD, EXPERT
  - **ì„¤ì •**: application.ymlì˜ difficulty
  - **ê¸°ë³¸ê°’**: NORMAL

#### FR-6: ë„¤íŠ¸ì›Œí¬ ì‹œìŠ¤í…œ (Multi ëª¨ë“œ)
- **FR-6.1**: ê³µê²© ì „ì†¡ (2ì¤„ ì´ìƒ í´ë¦¬ì–´ ì‹œ)
  - **ì¡°ê±´**: í•œ ë²ˆì— 2ì¤„ ì´ìƒ í´ë¦¬ì–´
  - **ê³„ì‚°**: 
    - 2ì¤„: 1 ê³µê²©
    - 3ì¤„: 2 ê³µê²©
    - 4ì¤„(Tetris): 4 ê³µê²©
  - **T-Spin ë³´ë„ˆìŠ¤**: +2 ê³µê²©
  
- **FR-6.2**: ê³µê²© ìˆ˜ì‹  ë° ì ìš©
  - **íƒ€ì´ë°**: ë‹¤ìŒ ë¸”ë¡ ê³ ì • ì‹œ
  - **íš¨ê³¼**: ë°”ë‹¥ì—ì„œ ì¤„ ì¶”ê°€
  - **ëŒ€ì‘**: ë¼ì¸ í´ë¦¬ì–´ë¡œ ìƒì‡„ ê°€ëŠ¥
  
- **FR-6.3**: ë„¤íŠ¸ì›Œí¬ ì¥ì•  ì²˜ë¦¬ (Proxy íŒ¨í„´)
  - **êµ¬í˜„**: NetworkServiceProxy
  - **ê¸°ëŠ¥**: 
    - ì¥ì•  ê°ì§€
    - ì˜¤í”„ë¼ì¸ íì‰
    - ìë™ ì¬ì—°ê²°
    
- **FR-6.4**: ì˜¤í”„ë¼ì¸ íì‰ ë° ìë™ ì¬ì „ì†¡
  - **í**: ConcurrentLinkedQueue
  - **ì¬ì „ì†¡**: ì¬ì—°ê²° ì‹œ ìë™ Flush
  
- **FR-6.5**: âœ… **ìë™ ì¬ì—°ê²° ë¡œì§ í•„ìˆ˜**
  - **êµ¬í˜„ ì¡°ê±´**: 
    - 5ì´ˆ ê°„ê²©ìœ¼ë¡œ Ping í…ŒìŠ¤íŠ¸
    - ScheduledExecutorService ì‚¬ìš©
  - **ì œì•½ì‚¬í•­**: ìµœëŒ€ ì¬ì—°ê²° ì‹œë„ íšŸìˆ˜ ì—†ìŒ (ê³„ì† ì‹œë„)
  - **ëª©ì **: ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘
  
- **FR-6.6**: âœ… **ì˜¤í”„ë¼ì¸ í í¬ê¸° ì œí•œ**
  - **ì œì•½ì‚¬í•­**: ìµœëŒ€ 1000ê°œ í•­ëª©
  - **ì´ˆê³¼ ì‹œ**: ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±° (FIFO)
  - **ëª©ì **: Memory Leak ë°©ì§€

#### FR-7: ë™ì‹œì„± ì²˜ë¦¬ â­ ì‹ ê·œ
- **FR-7.1**: âœ… **ëª¨ë“  ê³µìœ  ë³€ìˆ˜ëŠ” Thread-safe êµ¬í˜„**
  - **ë³€í™˜ ëª©ë¡**:
    - `boolean isProcessing` â†’ `AtomicBoolean isProcessing`
    - `int sequenceNumber` â†’ `AtomicInteger sequenceNumber`
    - `int eventSequenceId` â†’ `AtomicInteger eventSequenceId`
  - **ì´ìœ **: Race Condition ë°©ì§€
  
- **FR-7.2**: âœ… **Queue ì ‘ê·¼ ì‹œ synchronized ì‚¬ìš©**
  - **íŒ¨í„´**:
    ```java
    synchronized (lock) {
        eventQueue.addAll(events);
    }
    ```
  - **ëŒ€ìƒ**: UIEventHandler.eventQueue, NetworkServiceProxy.offlineQueue
  
- **FR-7.3**: âœ… **CAS (Compare-And-Swap) íŒ¨í„´ ì‚¬ìš©**
  - **íŒ¨í„´**:
    ```java
    if (isProcessing.compareAndSet(false, true)) {
        processNextEvent();
    }
    ```
  - **ëª©ì **: ì›ìì  ìƒíƒœ ë³€ê²½

#### FR-8: ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ â­ ì‹ ê·œ
- **FR-8.1**: âœ… **ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ê¸° êµ¬í˜„ í•„ìˆ˜**
  - **êµ¬í˜„**: @ControllerAdvice
  - **ë³€í™˜**: ëª¨ë“  ì˜ˆì™¸ë¥¼ ErrorResponse DTOë¡œ ë³€í™˜
  - **ë¡œê¹…**: ERROR ë ˆë²¨ë¡œ ê¸°ë¡
  
- **FR-8.2**: âœ… **ì—ëŸ¬ ì½”ë“œ í‘œì¤€í™”**
  | ì½”ë“œ | ì´ë¦„ | ì„¤ëª… | HTTP ìƒíƒœ |
  |------|------|------|-----------|
  | 400 | INVALID_COMMAND | ì˜ëª»ëœ Command | Bad Request |
  | 408 | NETWORK_TIMEOUT | ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ | Request Timeout |
  | 409 | STATE_CONFLICT | ìƒíƒœ ë¶ˆì¼ì¹˜ | Conflict |
  | 429 | TOO_MANY_REQUESTS | Rate Limit ì´ˆê³¼ | Too Many Requests |
  | 500 | INTERNAL_ERROR | ë‚´ë¶€ ì˜¤ë¥˜ | Internal Server Error |
  | 503 | SERVICE_UNAVAILABLE | ì„œë¹„ìŠ¤ ë¶ˆê°€ | Service Unavailable |
  
- **FR-8.3**: âœ… **ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°**
  ```
  TetrisException (extends RuntimeException)
  â”œâ”€â”€ NetworkException
  â”‚   â”œâ”€â”€ ConnectionException
  â”‚   â””â”€â”€ TimeoutException
  â”œâ”€â”€ ValidationException
  â”‚   â”œâ”€â”€ InvalidCommandException
  â”‚   â””â”€â”€ InvalidStateException
  â”œâ”€â”€ StateConflictException
  â””â”€â”€ CheatDetectedException
  ```
  
- **FR-8.4**: âœ… **Graceful Degradation**
  | ì˜ˆì™¸ | ì²˜ë¦¬ ë°©ì‹ | ì‚¬ìš©ì ë©”ì‹œì§€ |
  |------|----------|--------------|
  | NetworkException | ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì „í™˜ | "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤." |
  | StateConflictException | ì„œë²„ ìƒíƒœë¡œ ê°•ì œ ë™ê¸°í™” | "ê²Œì„ ìƒíƒœê°€ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤." |
  | ValidationException | ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ | "ì˜ëª»ëœ ì¡°ì‘ì…ë‹ˆë‹¤." |
  | CheatDetectedException | ê²Œì„ ì¢…ë£Œ | "ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í–‰ìœ„ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤." |

#### FR-9: ë³´ì•ˆ ì‹œìŠ¤í…œ â­ ì‹ ê·œ
- **FR-9.1**: âœ… **JWT ì¸ì¦ í•„ìˆ˜** (ë©€í‹°í”Œë ˆì´ì–´)
  - **í† í° êµ¬ì¡°**:
    ```json
    {
      "sub": "player123",
      "iat": 1699999999,
      "exp": 1700003599
    }
    ```
  - **ë§Œë£Œ ì‹œê°„**: 1ì‹œê°„ (3600ì´ˆ)
  - **Refresh Token**: ì§€ì› (7ì¼ ìœ íš¨)
  - **í—¤ë”**: Authorization: Bearer {token}
  
- **FR-9.2**: âœ… **Rate Limiting**
  - **ì œí•œ**: í”Œë ˆì´ì–´ë‹¹ ìµœëŒ€ 100 req/min
  - **ì•Œê³ ë¦¬ì¦˜**: Sliding Window
  - **êµ¬í˜„**: Guava RateLimiter
  - **ì´ˆê³¼ ì‹œ**: 429 Too Many Requests
  
- **FR-9.3**: âœ… **Cheating Detection**
  - **ê²€ì¦ í•­ëª©**:
    | í•­ëª© | ì„ê³„ê°’ | ì¡°ì¹˜ |
    |------|--------|------|
    | ì ìˆ˜ ì¦ê°€ìœ¨ | ìµœëŒ€ 1000ì /ì´ˆ | ê²½ê³  â†’ ê±°ë¶€ |
    | ë¼ì¸ í´ë¦¬ì–´ | ìµœëŒ€ 10ì¤„/ì´ˆ | ê²½ê³  â†’ ê±°ë¶€ |
    | Command ê°„ê²© | ìµœì†Œ 5ms | ê²½ê³  â†’ ê±°ë¶€ |
  - **íƒì§€ ì‹œ**: 
    1. Command ê±°ë¶€
    2. ê²½ê³  ë¡œê·¸ ê¸°ë¡
    3. ìœ„ë°˜ íšŸìˆ˜ ì¦ê°€
  - **3íšŒ íƒì§€ ì‹œ**: ê²Œì„ ê°•ì œ ì¢…ë£Œ + IP ì°¨ë‹¨ (ì„ íƒ)

---

### 1.4 ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

#### NFR-1: í™•ì¥ì„±
- **NFR-1.1**: Strategy íŒ¨í„´ìœ¼ë¡œ PlayType í™•ì¥ ìš©ì´
  - **ì¸í„°í˜ì´ìŠ¤**: PlayTypeStrategy
  - **êµ¬í˜„**: SinglePlayStrategy, MultiPlayStrategy
  - **ì¶”ê°€**: ìƒˆ Strategy í´ë˜ìŠ¤ë§Œ ì¶”ê°€í•˜ë©´ ë¨
  
- **NFR-1.2**: Composition íŒ¨í„´ìœ¼ë¡œ GameplayType ë…ë¦½ êµ¬ì„±
  - **ì¸í„°í˜ì´ìŠ¤**: GameEngine
  - **êµ¬í˜„**: ClassicGameEngine, ArcadeGameEngine
  - **ì¡°í•©**: PlayType + GameplayType ë…ë¦½ì 
  
- **NFR-1.3**: ìƒˆ ëª¨ë“œ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”
  - **ëª©í‘œ**: Open/Closed Principle ì¤€ìˆ˜
  - **ì¸¡ì •**: ì‹ ê·œ ëª¨ë“œ ì¶”ê°€ ì‹œ ë³€ê²½ë˜ëŠ” íŒŒì¼ ìˆ˜ < 3ê°œ

#### NFR-2: ë°˜ì‘ì„±
- **NFR-2.1**: Client-Side Predictionìœ¼ë¡œ ì¦‰ì‹œ í”¼ë“œë°±
  - **ëª©í‘œ**: ì‚¬ìš©ì ì…ë ¥ì— ì¦‰ì‹œ ë°˜ì‘
  - **êµ¬í˜„**: ì„œë²„ ì „ì†¡ ì „ ë¡œì»¬ì—ì„œ ë¨¼ì € ì‹¤í–‰
  
- **NFR-2.2**: Local Events ì¦‰ì‹œ í‘œì‹œ (<50ms)
  - **ëª©í‘œ**: ë¸”ë¡ ì´ë™, íšŒì „ ì‹œ ì¦‰ì‹œ í”¼ë“œë°±
  - **ì¸¡ì •**: ì…ë ¥ â†’ í™”ë©´ ê°±ì‹  ì‹œê°„
  
- **NFR-2.3**: ë„¤íŠ¸ì›Œí¬ ì§€ì—° í—ˆìš© ë²”ìœ„ (100-200ms)
  - **í—ˆìš©**: RTT(Round Trip Time) 200msê¹Œì§€
  - **ì´ˆê³¼ ì‹œ**: ê²½ê³  í‘œì‹œ
  
- **NFR-2.4**: âœ… **Command ì²˜ë¦¬ ì‹œê°„ ì œí•œ**
  - **ëª©í‘œ**: 
    - í‰ê·  <50ms
    - ìµœëŒ€ <100ms
  - **ì¸¡ì •**: @Measured ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì„±ëŠ¥ ë¡œê¹…

#### NFR-3: ì¼ê´€ì„±
- **NFR-3.1**: Server Authoritativeë¡œ ì¹˜íŒ… ë°©ì§€
  - **ì›ì¹™**: ì„œë²„ ì‘ë‹µì´ ìµœì¢… ì§„ì‹¤
  - **ê²€ì¦**: ì„œë²„ì—ì„œ ëª¨ë“  ë¡œì§ ì¬ì‹¤í–‰
  
- **NFR-3.2**: State Reconciliationìœ¼ë¡œ ë™ê¸°í™”
  - **ë¹„êµ**: ë¡œì»¬ ì˜ˆì¸¡ vs ì„œë²„ ì‘ë‹µ
  - **ë¶ˆì¼ì¹˜**: ì„œë²„ ìƒíƒœ ìš°ì„ 
  
- **NFR-3.3**: Critical Events ì„œë²„ ìƒì„±ìœ¼ë¡œ ì¼ê´€ì„± ë³´ì¥
  - **ìƒì„±**: CriticalEventGenerator (ì„œë²„)
  - **ì „ì†¡**: GameUpdateResponse.events[]
  
- **NFR-3.4**: âœ… **State Mismatch ê°ì§€**
  - **ê²€ì¦ í•­ëª©**:
    - currentTetromino (ìœ„ì¹˜, íƒ€ì…)
    - score (ì ìˆ˜)
    - grid (ë³´ë“œ ìƒíƒœ)
  - **ë¶ˆì¼ì¹˜ ì‹œ**:
    1. ì—ëŸ¬ ë¡œê·¸ ê¸°ë¡
    2. ì„œë²„ ìƒíƒœë¡œ ê°•ì œ ë™ê¸°í™”
    3. Pending Commands ì¬ì‹¤í–‰
    
- **NFR-3.5**: âœ… **Pending Commands íƒ€ì„ì•„ì›ƒ**
  - **ì œì•½ì‚¬í•­**: 5ì´ˆ ë‚´ ì„œë²„ ì‘ë‹µ ì—†ìœ¼ë©´ íƒ€ì„ì•„ì›ƒ
  - **íƒ€ì„ì•„ì›ƒ ì‹œ**:
    1. Command ì œê±°
    2. ì¬ì „ì†¡ (ìµœëŒ€ 3íšŒ)
    3. ì¬ì „ì†¡ ì‹¤íŒ¨ ì‹œ ì·¨ì†Œ

#### NFR-4: ìœ ì§€ë³´ìˆ˜ì„±
- **NFR-4.1**: ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜
  - **ê° í´ë˜ìŠ¤**: í•˜ë‚˜ì˜ ì±…ì„ë§Œ
  - **ì˜ˆì‹œ**: CommandHandlerëŠ” Command ì²˜ë¦¬ë§Œ
  
- **NFR-4.2**: ëª¨ë“ˆ ê²½ê³„ ëª…í™•
  - **Core**: ê²Œì„ ë¡œì§ë§Œ
  - **Client**: UI + ë„¤íŠ¸ì›Œí¬
  - **Backend**: API + DB
  
- **NFR-4.3**: Spring Boot ì»¨ë²¤ì…˜ ì¤€ìˆ˜
  - **êµ¬ì¡°**: Controller-Service-Repository
  - **ì„¤ì •**: application.yml
  - **Bean ë“±ë¡**: @Component, @Service, @Repository
  
- **NFR-4.4**: âœ… **BoardController ì±…ì„ ë¶„ë¦¬** (ì„ íƒì )
  - **ë¶„ë¦¬ ëŒ€ìƒ**:
    - CommandHandler: Command ì²˜ë¦¬
    - GameStateManager: ìƒíƒœ ê´€ë¦¬
    - ServerCommunicator: ì„œë²„ í†µì‹ 
    - UIRenderer: ë Œë”ë§
  - **ì ìš© ì‹œì **: Phase 3 (ì„ íƒ)

#### NFR-5: í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±
- **NFR-5.1**: ê° ì»´í¬ë„ŒíŠ¸ ë…ë¦½ì  í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
  - **ì˜ì¡´ì„± ì£¼ì…**: Spring DI í™œìš©
  - **Interface**: Mock ì£¼ì… ìš©ì´
  
- **NFR-5.2**: Mock ì£¼ì… ìš©ì´
  - **ë„êµ¬**: Mockito
  - **íŒ¨í„´**: @Mock, @InjectMocks
  
- **NFR-5.3**: Spring Test í™œìš©
  - **ë‹¨ìœ„**: @SpringBootTest(classes = {...})
  - **í†µí•©**: @SpringBootTest
  - **ì›¹**: @WebMvcTest, @AutoConfigureMockMvc

#### NFR-6: ë™ì‹œì„± ì•ˆì •ì„± â­ ì‹ ê·œ
- **NFR-6.1**: âœ… **Race Condition ì œê±°**
  - **ë°©ë²•**:
    - AtomicBoolean/AtomicInteger ì‚¬ìš©
    - synchronized block ì‚¬ìš©
    - CAS íŒ¨í„´ ì‚¬ìš©
  - **ê²€ì¦**: ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ í…ŒìŠ¤íŠ¸ (100 ìŠ¤ë ˆë“œ)
  
- **NFR-6.2**: âœ… **Deadlock ë°©ì§€**
  - **ì›ì¹™**:
    - Lock ìˆœì„œ ì¼ê´€ì„± ìœ ì§€
    - ì¤‘ì²© Lock ìµœì†Œí™”
    - Timeout ì„¤ì • (tryLock)
  - **ê²€ì¦**: ì¥ì‹œê°„ ë¶€í•˜ í…ŒìŠ¤íŠ¸
  
- **NFR-6.3**: âœ… **Memory Visibility ë³´ì¥**
  - **volatile**: ë‹¨ìˆœ í”Œë˜ê·¸ (connected)
  - **AtomicReference**: ê°ì²´ ì°¸ì¡° (gameState)

#### NFR-7: ì˜¤ë¥˜ ë³µêµ¬ ëŠ¥ë ¥ â­ ì‹ ê·œ
- **NFR-7.1**: âœ… **ë„¤íŠ¸ì›Œí¬ ì¥ì•  ìë™ ë³µêµ¬**
  - **ì¬ì—°ê²°**: 5ì´ˆ ê°„ê²© ìë™ ì‹œë„
  - **ì˜¤í”„ë¼ì¸ í**: ìµœëŒ€ 1000ê°œ
  - **ì¬ì—°ê²° ì‹œ**: ìë™ Flush
  
- **NFR-7.2**: âœ… **ìƒíƒœ ë¶ˆì¼ì¹˜ ìë™ ë³µêµ¬**
  - **ê°ì§€**: Mismatch ë¹„êµ
  - **ë³µêµ¬**: ì„œë²„ ìƒíƒœë¡œ ë™ê¸°í™”
  - **ì¬ì‹¤í–‰**: Pending Commands
  
- **NFR-7.3**: âœ… **Graceful Degradation**
  - **ì›ì¹™**: ì „ì²´ ì‹¤íŒ¨ë³´ë‹¤ ë¶€ë¶„ ì„±ê³µ
  - **ì˜ˆì‹œ**:
    - ì„œë²„ ì˜¤ë¥˜ â†’ ì‹±ê¸€ í”Œë ˆì´ ì œì•ˆ
    - UI ì˜¤ë¥˜ â†’ ê¸°ë³¸ UIë¡œ ëŒ€ì²´

#### NFR-8: ë³´ì•ˆì„± â­ ì‹ ê·œ
- **NFR-8.1**: âœ… **ì¸ì¦ í•„ìˆ˜**
  - **ê²€ì¦**: ëª¨ë“  API ìš”ì²­ì— JWT ê²€ì¦
  - **ì‹¤íŒ¨**: 401 Unauthorized
  
- **NFR-8.2**: âœ… **ì…ë ¥ ê²€ì¦**
  - **ì„œë²„**: ëª¨ë“  Command ê²€ì¦
  - **ê²€ì¦**: ë²”ìœ„ ì²´í¬, íƒ€ì… ì²´í¬, ìœ íš¨ì„± ì²´í¬
  
- **NFR-8.3**: âœ… **ì¹˜íŒ… ë°©ì§€**
  - **ê²€ì¦**: ì ìˆ˜/ë¼ì¸ í´ë¦¬ì–´ ì†ë„
  - **ë¡œê·¸**: ì˜ì‹¬ í–‰ìœ„ ê¸°ë¡
  - **ì¡°ì¹˜**: 3íšŒ íƒì§€ ì‹œ ê²Œì„ ì¢…ë£Œ

#### NFR-9: ì„±ëŠ¥ â­ ì‹ ê·œ
- **NFR-9.1**: âœ… **ì‘ë‹µ ì‹œê°„**
  | ì‘ì—… | í‰ê·  | ìµœëŒ€ | ì¸¡ì • ë°©ë²• |
  |------|------|------|----------|
  | Command ì²˜ë¦¬ | <50ms | <100ms | @Measured |
  | State Update | <100ms | <200ms | @Measured |
  | Local Event í‘œì‹œ | <50ms | N/A | Stopwatch |
  
- **NFR-9.2**: âœ… **ì²˜ë¦¬ëŸ‰**
  - **ë™ì‹œ ì ‘ì†**: 1000ëª…
  - **ì„œë²„ ì²˜ë¦¬ëŸ‰**: 1000 req/s (Throttling ì ìš© ì‹œ)
  - **ì¸¡ì •**: JMeter, Gatling
  
- **NFR-9.3**: âœ… **ë©”ëª¨ë¦¬**
  | í•­ëª© | ì œí•œ | ì¸¡ì • ë°©ë²• |
  |------|------|----------|
  | í´ë¼ì´ì–¸íŠ¸ | ìµœëŒ€ 512MB | JVM -Xmx |
  | ì„œë²„ (í”Œë ˆì´ì–´ë‹¹) | ìµœëŒ€ 10MB | Profiler |
  | ì˜¤í”„ë¼ì¸ í | ìµœëŒ€ 100KB | sizeof |

#### NFR-10: í…ŒìŠ¤íŠ¸ ì „ëµ â­ ì‹ ê·œ
- **NFR-10.1**: âœ… **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**
  - **ì»¤ë²„ë¦¬ì§€**: ìµœì†Œ 80%
  - **ë„êµ¬**: JUnit 5, Mockito
  - **ëŒ€ìƒ**: GameEngine, PlayTypeStrategy, UIEventHandler
  - **ì‹¤í–‰**: mvn test
  
- **NFR-10.2**: âœ… **í†µí•© í…ŒìŠ¤íŠ¸**
  - **ì»¤ë²„ë¦¬ì§€**: ì£¼ìš” íë¦„ 100%
  - **ë„êµ¬**: Spring Boot Test, TestContainers
  - **ì‹œë‚˜ë¦¬ì˜¤**: 
    - Command â†’ ì„œë²„ â†’ ì‘ë‹µ
    - State Reconciliation
    - ë„¤íŠ¸ì›Œí¬ ì¥ì• 
    
- **NFR-10.3**: âœ… **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**
  - **ë„êµ¬**: JMeter, Gatling
  - **ì‹œë‚˜ë¦¬ì˜¤**:
    - 1000ëª… ë™ì‹œ ì ‘ì†
    - ì‘ë‹µ ì‹œê°„ <100ms
    - ì—ëŸ¬ìœ¨ <1%
    
- **NFR-10.4**: âœ… **E2E í…ŒìŠ¤íŠ¸**
  - **ë„êµ¬**: TestFX (JavaFX)
  - **ì‹œë‚˜ë¦¬ì˜¤**: ì „ì²´ ê²Œì„ í”Œë ˆì´

#### NFR-11: ëª¨ë‹ˆí„°ë§ â­ ì‹ ê·œ
- **NFR-11.1**: âœ… **ë©”íŠ¸ë¦­ ìˆ˜ì§‘**
  | ë©”íŠ¸ë¦­ | íƒ€ì… | ì„¤ëª… |
  |--------|------|------|
  | game.commands.total | Counter | ì´ Command ìˆ˜ |
  | game.commands.duration | Timer | Command ì²˜ë¦¬ ì‹œê°„ |
  | game.active.players | Gauge | í™œì„± í”Œë ˆì´ì–´ ìˆ˜ |
  | game.state.conflicts | Counter | ìƒíƒœ ë¶ˆì¼ì¹˜ íšŸìˆ˜ |
  
- **NFR-11.2**: âœ… **ì•Œë¦¼ ì„¤ì •**
  | ì¡°ê±´ | ë ˆë²¨ | ì•¡ì…˜ |
  |------|------|------|
  | ì—ëŸ¬ìœ¨ > 5% | ê²½ê³  | Slack ì•Œë¦¼ |
  | ì‘ë‹µ ì‹œê°„ > 200ms | ê²½ê³  | Slack ì•Œë¦¼ |
  | ë™ì‹œ ì ‘ì† > 900ëª… | ì£¼ì˜ | Email ì•Œë¦¼ |
  | ì„œë¹„ìŠ¤ ë‹¤ìš´ | ê¸´ê¸‰ | PagerDuty |
  
- **NFR-11.3**: âœ… **ëŒ€ì‹œë³´ë“œ**
  - **ë„êµ¬**: Grafana
  - **íŒ¨ë„**:
    - ìš”ì²­ ìˆ˜ (ì‹œê³„ì—´)
    - ì‘ë‹µ ì‹œê°„ (íˆìŠ¤í† ê·¸ë¨)
    - ì—ëŸ¬ìœ¨ (ê²Œì´ì§€)
    - í™œì„± í”Œë ˆì´ì–´ (ê²Œì´ì§€)
  - **ë³´ê´€**: íˆìŠ¤í† ë¦¬ ë°ì´í„° 7ì¼

#### NFR-12: ë¡œê¹… ì „ëµ â­ ì‹ ê·œ
- **NFR-12.1**: âœ… **ë¡œê·¸ ë ˆë²¨**
  | ë ˆë²¨ | ìš©ë„ | í™˜ê²½ |
  |------|------|------|
  | TRACE | ìƒì„¸ ë””ë²„ê¹… | ê°œë°œ |
  | DEBUG | ì¼ë°˜ ë””ë²„ê¹… | ê°œë°œ |
  | INFO | ì¤‘ìš” ì´ë²¤íŠ¸ | ìš´ì˜ |
  | WARN | ê²½ê³  (100ms ì´ìƒ) | ìš´ì˜ |
  | ERROR | ì˜¤ë¥˜ | ìš´ì˜ |
  
- **NFR-12.2**: âœ… **ë¡œê·¸ í¬ë§·**
  - **í˜•ì‹**: JSON (êµ¬ì¡°í™”ëœ ë¡œê·¸)
  - **í•„ë“œ**:
    - timestamp: ISO 8601
    - thread: ìŠ¤ë ˆë“œëª…
    - level: ë¡œê·¸ ë ˆë²¨
    - logger: ë¡œê±°ëª…
    - message: ë¡œê·¸ ë©”ì‹œì§€
    - exception: ì˜ˆì™¸ ìŠ¤íƒ (ERROR)
    
- **NFR-12.3**: âœ… **ë¡œê·¸ ë³´ê´€**
  - **íŒŒì¼**: logs/tetris-client.log
  - **í¬ê¸°**: ìµœëŒ€ 10MB per file
  - **ë³´ê´€**: 30ì¼
  - **ì••ì¶•**: gzip
  
- **NFR-12.4**: âœ… **ì„±ëŠ¥ ë¡œê¹…**
  - **ì–´ë…¸í…Œì´ì…˜**: @Measured
  - **AOP**: PerformanceLoggingAspect
  - **ì„ê³„ê°’**: 100ms ì´ìƒ ê±¸ë¦¬ë©´ WARN

---

### 1.5 ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ (Business Rules)

#### BR-1: ì ìˆ˜ ê³„ì‚° ê·œì¹™
- **BR-1.1**: ë¼ì¸ í´ë¦¬ì–´ ì ìˆ˜
  ```
  ê¸°ë³¸ ì ìˆ˜ = (ë¼ì¸ ìˆ˜)Â² Ã— 100 Ã— ë ˆë²¨ Ã— ë‚œì´ë„ ë°°ìœ¨
  
  ë‚œì´ë„ ë°°ìœ¨ (SRS í‘œì¤€):
  - EASY: 0.5x (ì´ˆë³´ì)
  - NORMAL: 1.0x (ê¸°ì¤€)
  - HARD: 1.5x (ìˆ™ë ¨ì)
  - EXPERT: 2.0x (ì „ë¬¸ê°€)
  
  ì˜ˆì‹œ 1 (NORMAL, ë ˆë²¨ 5):
  - 1ì¤„: 1Â² Ã— 100 Ã— 5 Ã— 1.0 = 500ì 
  - 2ì¤„: 2Â² Ã— 100 Ã— 5 Ã— 1.0 = 2,000ì 
  - 3ì¤„: 3Â² Ã— 100 Ã— 5 Ã— 1.0 = 4,500ì 
  - 4ì¤„: 4Â² Ã— 100 Ã— 5 Ã— 1.0 = 8,000ì 
  
  ì˜ˆì‹œ 2 (HARD, ë ˆë²¨ 5, 4ì¤„ í´ë¦¬ì–´):
  - 4ì¤„: 4Â² Ã— 100 Ã— 5 Ã— 1.5 = 12,000ì  (NORMAL ëŒ€ë¹„ 1.5ë°°)
  
  ì˜ˆì‹œ 3 (EASY, ë ˆë²¨ 5, 4ì¤„ í´ë¦¬ì–´):
  - 4ì¤„: 4Â² Ã— 100 Ã— 5 Ã— 0.5 = 4,000ì  (NORMAL ëŒ€ë¹„ 0.5ë°°)
  ```
  - **ê·¼ê±°**: ë§ì€ ì¤„ì„ ë™ì‹œì— í´ë¦¬ì–´í• ìˆ˜ë¡ ë†’ì€ ì ìˆ˜ (ì „ëµì  í”Œë ˆì´ ìœ ë„), ë†’ì€ ë‚œì´ë„ì— ëŒ€í•œ ì •ë‹¹í•œ ë³´ìƒ

- **BR-1.2**: T-Spin ë³´ë„ˆìŠ¤
  ```
  T-Spin: ê¸°ë³¸ ì ìˆ˜ Ã— 2
  T-Spin Mini: ê¸°ë³¸ ì ìˆ˜ Ã— 1.5
  
  ì˜ˆì‹œ (T-Spin Double, NORMAL, ë ˆë²¨ 5):
  - ê¸°ë³¸: 2Â² Ã— 100 Ã— 5 Ã— 1.0 = 2,000ì 
  - T-Spin: 2,000 Ã— 2 = 4,000ì 
  ```
  - **ê·¼ê±°**: ê³ ë‚œì´ë„ ê¸°ìˆ ì— ëŒ€í•œ ë³´ìƒ

- **BR-1.3**: ì½¤ë³´ ë³´ë„ˆìŠ¤
  ```
  ì½¤ë³´ ì ìˆ˜ = ì½¤ë³´ ìˆ˜ Ã— 50 Ã— ë ˆë²¨
  ìµœëŒ€ ì½¤ë³´: 20 (ì½¤ë³´ ìˆ˜ê°€ 20ì„ ë„˜ì–´ë„ 20ìœ¼ë¡œ ê³„ì‚°)
  
  ì˜ˆì‹œ (ì½¤ë³´ 5, ë ˆë²¨ 5):
  - ì½¤ë³´ ì ìˆ˜: 5 Ã— 50 Ã— 5 = 1,250ì 
  ```
  - **ê·¼ê±°**: ì—°ì† í´ë¦¬ì–´ ìœ ë„, ê²Œì„ì˜ ì¬ë¯¸ ì¦ê°€

- **BR-1.4**: Perfect Clear ë³´ë„ˆìŠ¤
  ```
  ë³´ë“œ ì™„ì „ í´ë¦¬ì–´ ì‹œ: 10,000ì  Ã— ë ˆë²¨
  
  ì˜ˆì‹œ (ë ˆë²¨ 5):
  - Perfect Clear: 10,000 Ã— 5 = 50,000ì 
  ```
  - **ê·¼ê±°**: ìµœê³  ë‚œì´ë„ ë‹¬ì„±ì— ëŒ€í•œ í° ë³´ìƒ

- **BR-1.5**: ì†Œí”„íŠ¸ ë“œë¡­ / í•˜ë“œ ë“œë¡­ ì ìˆ˜
  ```
  ì†Œí”„íŠ¸ ë“œë¡­: 1ì  per ì¹¸
  í•˜ë“œ ë“œë¡­: 2ì  per ì¹¸
  ```
  - **ê·¼ê±°**: ë¹ ë¥¸ í”Œë ˆì´ ìœ ë„

#### BR-2: ë ˆë²¨ ì§„í–‰ ê·œì¹™
- **BR-2.1**: ë ˆë²¨ ì—… ì¡°ê±´
  ```
  ë ˆë²¨ ì—… = ê²Œì„ ì‹œì‘ í›„ ëˆ„ì  í´ë¦¬ì–´ ì¤„ ìˆ˜
  ê³µì‹: ë ˆë²¨ N ë‹¬ì„± = 10 Ã— N ì¤„ (ëˆ„ì )
  
  ì˜ˆì‹œ:
  - ë ˆë²¨ 0 â†’ 1: ëˆ„ì  10ì¤„ (ì¶”ê°€ 10ì¤„ í´ë¦¬ì–´)
  - ë ˆë²¨ 1 â†’ 2: ëˆ„ì  20ì¤„ (ì¶”ê°€ 10ì¤„ í´ë¦¬ì–´)
  - ë ˆë²¨ 2 â†’ 3: ëˆ„ì  30ì¤„ (ì¶”ê°€ 10ì¤„ í´ë¦¬ì–´)
  ```
  - **ì½”ë“œ êµ¬í˜„**: `currentLevel = totalLinesCleared / 10`
  - **ê·¼ê±°**: ì¼ì •í•œ ì§„í–‰ ì†ë„ ìœ ì§€, ëª…í™•í•œ ë ˆë²¨ ê³„ì‚°

- **BR-2.2**: ë‚™í•˜ ì†ë„ ì¦ê°€
  ```
  ë‚™í•˜ ì†ë„ = max(100ms, 1000ms - (ë ˆë²¨ Ã— 80ms))
  ìµœì†Œ ì†ë„ = 100ms (ë ˆë²¨ 12 ì´ìƒë¶€í„° ìµœì†Œê°’ ì ìš©)
  
  ì˜ˆì‹œ:
  - ë ˆë²¨ 1: max(100, 920) = 920ms per ì¹¸
  - ë ˆë²¨ 5: max(100, 600) = 600ms per ì¹¸
  - ë ˆë²¨ 10: max(100, 200) = 200ms per ì¹¸
  - ë ˆë²¨ 11: max(100, 120) = 120ms per ì¹¸
  - ë ˆë²¨ 12: max(100, 40) = 100ms per ì¹¸ (ìµœì†Œê°’ ì ìš© ì‹œì‘)
  - ë ˆë²¨ 15+: max(100, ìŒìˆ˜) = 100ms per ì¹¸ (ìµœì†Œ)
  ```
  - **ì½”ë“œ êµ¬í˜„**: `Math.max(100L, 1000L - (level * 80L))`
  - **ê·¼ê±°**: ì ì§„ì  ë‚œì´ë„ ì¦ê°€, ìˆ˜í•™ì ìœ¼ë¡œ ì •í™•í•œ ìµœì†Œê°’ ì ìš©

- **BR-2.3**: ë ˆë²¨ í‘œì‹œ
  ```
  í™”ë©´ í‘œì‹œ: "Level 5"
  ìµœëŒ€ ë ˆë²¨: ë¬´ì œí•œ (UIëŠ” 3ìë¦¬ê¹Œì§€ í‘œì‹œ)
  ```

#### BR-3: ê²Œì„ ì¢…ë£Œ ê·œì¹™
- **BR-3.1**: íŒ¨ë°° ì¡°ê±´ (ì‹±ê¸€ í”Œë ˆì´)
  ```
  ì¡°ê±´: ìƒˆ í…ŒíŠ¸ë¡œë¯¸ë…¸ ìƒì„± ì‹œ ì¶©ëŒ ë°œìƒ
  íƒ€ì´ë°: lockTetromino() í›„ ìƒˆ ë¸”ë¡ ìƒì„± ì‹œ
  ```
  - **ì²˜ë¦¬**: 
    1. ê²Œì„ ì¦‰ì‹œ ì •ì§€
    2. GAME_OVER ì´ë²¤íŠ¸ ìƒì„±
    3. ìµœì¢… ì ìˆ˜ í‘œì‹œ
    4. ì„œë²„ ì „ì†¡ (ë©€í‹° í”Œë ˆì´)

- **BR-3.2**: ìŠ¹ë¦¬ ì¡°ê±´ (ë©€í‹° í”Œë ˆì´)
  ```
  ì¡°ê±´ 1: ìƒëŒ€ë°© GAME_OVER
  ì¡°ê±´ 2: ìƒëŒ€ë°© ì—°ê²° ëŠê¹€ (5ì´ˆ ëŒ€ê¸° í›„)
  ì¡°ê±´ 3: ì œí•œ ì‹œê°„ ì¢…ë£Œ ì‹œ ë†’ì€ ì ìˆ˜
  ```
  - **ì²˜ë¦¬**:
    1. VICTORY ì´ë²¤íŠ¸ ìƒì„±
    2. ìŠ¹ë¦¬ í™”ë©´ í‘œì‹œ
    3. ìˆœìœ„í‘œ ì—…ë°ì´íŠ¸

- **BR-3.3**: ë¬´ìŠ¹ë¶€ ì¡°ê±´ (ë©€í‹° í”Œë ˆì´)
  ```
  ì¡°ê±´: ë™ì‹œ GAME_OVER (ë™ì¼ í„´)
  ```
  - **ì²˜ë¦¬**: ì–‘ìª½ ëª¨ë‘ DRAW ì´ë²¤íŠ¸

#### BR-4: ë©€í‹°í”Œë ˆì´ ê³µê²© ê·œì¹™
- **BR-4.1**: ê³µê²© ë¼ì¸ ê³„ì‚°
  ```
  1ì¤„: 0 ê³µê²© (ê³µê²© ì—†ìŒ)
  2ì¤„: 1 ê³µê²©
  3ì¤„: 2 ê³µê²©
  4ì¤„ (Tetris): 4 ê³µê²©
  
  T-Spin ë³´ë„ˆìŠ¤:
  - T-Spin Mini: +1 ê³µê²©
  - T-Spin Single: +2 ê³µê²©
  - T-Spin Double: +4 ê³µê²©
  - T-Spin Triple: +6 ê³µê²©
  
  ì½¤ë³´ ë³´ë„ˆìŠ¤:
  - ì½¤ë³´ 1: +0 ê³µê²©
  - ì½¤ë³´ 2-4: +1 ê³µê²©
  - ì½¤ë³´ 5-8: +2 ê³µê²©
  - ì½¤ë³´ 9+: +3 ê³µê²©
  ```

- **BR-4.2**: ê³µê²© ì ìš© íƒ€ì´ë°
  ```
  íƒ€ì´ë°: ë‹¤ìŒ í…ŒíŠ¸ë¡œë¯¸ë…¸ ê³ ì •(lock) ì‹œ
  ìœ„ì¹˜: ë³´ë“œ ë§¨ ì•„ë˜ì—ì„œ ì¶”ê°€
  íŒ¨í„´: ëœë¤ êµ¬ë© (í•œ ì¤„ë‹¹ 1ê°œ)
  ```

- **BR-4.3**: ê³µê²© ìƒì‡„
  ```
  ìƒì‡„: ê³µê²© ë°›ê¸° ì „ì— ë¼ì¸ í´ë¦¬ì–´ ì‹œ ê³µê²© ê°ì†Œ
  
  ì˜ˆì‹œ:
  - ëŒ€ê¸° ê³µê²©: 3ì¤„
  - 2ì¤„ í´ë¦¬ì–´: 1 ê³µê²© ë°œë™
  - ë‚¨ì€ ê³µê²©: 3 - 1 = 2ì¤„
  ```

#### BR-5: ì•„ì´í…œ ì‚¬ìš© ê·œì¹™ (Arcade ëª¨ë“œ)
- **BR-5.1**: ì•„ì´í…œ íšë“
  ```
  ì¡°ê±´: ì•„ì´í…œ ë¸”ë¡ì´ ë°”ë‹¥ì— ë‹¿ìŒ
  íš¨ê³¼: ì¦‰ì‹œ ì¸ë²¤í† ë¦¬ì— ì¶”ê°€
  ìµœëŒ€ ë³´ìœ : 3ê°œ
  ```

- **BR-5.2**: ì•„ì´í…œ ì‚¬ìš©
  ```
  íƒ€ì´ë°: ê²Œì„ ì¤‘ ì–¸ì œë“ ì§€ (í‚¤ ì…ë ¥)
  ì œì•½: ê²Œì„ ì¢…ë£Œ ì‹œ ì‚¬ìš© ë¶ˆê°€
  ```

- **BR-5.3**: ì•„ì´í…œ íš¨ê³¼ ì§€ì† ì‹œê°„
  ```
  SPEED_RESET: ì¦‰ì‹œ íš¨ê³¼ (ì˜êµ¬)
  BOMB: ì¦‰ì‹œ íš¨ê³¼ (1íšŒ)
  PLUS_ONE_LINE: ì¦‰ì‹œ íš¨ê³¼ (ìƒëŒ€ë°©ì—ê²Œ)
  BONUS_SCORE: ì¦‰ì‹œ íš¨ê³¼ (1íšŒ)
  ```

#### BR-6: ìˆœìœ„í‘œ ê·œì¹™
- **BR-6.1**: ìˆœìœ„ ê³„ì‚°
  ```
  1ìˆœìœ„: ì ìˆ˜ (ë†’ì€ìˆœ)
  2ìˆœìœ„: ë ˆë²¨ (ë†’ì€ìˆœ)
  3ìˆœìœ„: í”Œë ˆì´ ì‹œê°„ (ì§§ì€ìˆœ)
  ```

- **BR-6.2**: ìˆœìœ„í‘œ í‘œì‹œ
  ```
  ì „ì²´ ìˆœìœ„: ìƒìœ„ 100ëª…
  ê°œì¸ ìµœê³  ê¸°ë¡: ëª¨ë“œë³„ / ë‚œì´ë„ë³„
  ì¼ì¼ ìˆœìœ„: ë§¤ì¼ ìì • ì´ˆê¸°í™”
  ```

- **BR-6.3**: ê¸°ë¡ ìœ íš¨ì„±
  ```
  ì‹±ê¸€ í”Œë ˆì´: ë¡œì»¬ ì €ì¥ + ì„œë²„ ì „ì†¡ (ì„ íƒ)
  ë©€í‹° í”Œë ˆì´: ì„œë²„ ê²€ì¦ í•„ìˆ˜
  Arcade ëª¨ë“œ: ë³„ë„ ìˆœìœ„í‘œ
  ```

---

### 1.6 ì‹œìŠ¤í…œ ì œì•½ì‚¬í•­ (System Constraints)

#### SC-1: í•˜ë“œì›¨ì–´ ì œì•½ì‚¬í•­
- **SC-1.1**: í´ë¼ì´ì–¸íŠ¸ ìµœì†Œ ì‚¬ì–‘
  ```
  CPU: 2ì½”ì–´ ì´ìƒ (2.0 GHz)
  RAM: 4GB ì´ìƒ
  GPU: OpenGL 2.0 ì§€ì› (JavaFX ìš”êµ¬ì‚¬í•­)
  ì €ì¥ê³µê°„: 500MB ì´ìƒ
  ë„¤íŠ¸ì›Œí¬: 1Mbps ì´ìƒ (ë©€í‹° í”Œë ˆì´)
  ```

- **SC-1.2**: ì„œë²„ ê¶Œì¥ ì‚¬ì–‘
  ```
  CPU: 8ì½”ì–´ ì´ìƒ (3.0 GHz)
  RAM: 16GB ì´ìƒ
  ì €ì¥ê³µê°„: 100GB SSD
  ë„¤íŠ¸ì›Œí¬: 100Mbps ì´ìƒ
  ```

- **SC-1.3**: ë™ì‹œ ì ‘ì†ì ìˆ˜ ì œí•œ
  ```
  Phase 1: ìµœëŒ€ 100ëª…
  Phase 2: ìµœëŒ€ 500ëª…
  Phase 3: ìµœëŒ€ 1,000ëª…
  ```

#### SC-2: ì†Œí”„íŠ¸ì›¨ì–´ ì œì•½ì‚¬í•­
- **SC-2.1**: ìš´ì˜ì²´ì œ
  ```
  ì§€ì›: Windows 10+, macOS 11+, Ubuntu 20.04+
  JVM: Java 21 í•„ìˆ˜
  ```

- **SC-2.2**: ë°ì´í„°ë² ì´ìŠ¤
  ```
  ì—”ì§„: MySQL 8.0+
  ì¸ì½”ë”©: UTF-8MB4
  íƒ€ì„ì¡´: UTC
  ```

- **SC-2.3**: ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ ê³ ì •
  ```
  Spring Boot: 3.2.0 ~ 3.2.x
  JavaFX: 21.x
  MySQL Connector: 8.0.33
  ```

#### SC-3: ë„¤íŠ¸ì›Œí¬ ì œì•½ì‚¬í•­
- **SC-3.1**: í†µì‹  í”„ë¡œí† ì½œ
  ```
  REST API: HTTPS í•„ìˆ˜ (ìš´ì˜ í™˜ê²½)
  WebSocket: WSS í•„ìˆ˜ (ìš´ì˜ í™˜ê²½)
  í¬íŠ¸: 8080 (HTTP), 8443 (HTTPS)
  ```

- **SC-3.2**: ë©”ì‹œì§€ í¬ê¸° ì œí•œ
  ```
  REST Request: ìµœëŒ€ 1MB
  WebSocket Message: ìµœëŒ€ 64KB
  ```

- **SC-3.3**: ì—°ê²° íƒ€ì„ì•„ì›ƒ
  ```
  Connection Timeout: 10ì´ˆ
  Read Timeout: 30ì´ˆ
  WebSocket Idle: 5ë¶„ (Ping/Pong)
  ```

#### SC-4: ë³´ì•ˆ ì œì•½ì‚¬í•­
- **SC-4.1**: ì¸ì¦ í† í°
  ```
  ì•Œê³ ë¦¬ì¦˜: HS256
  ë§Œë£Œ: 1ì‹œê°„
  Refresh: 7ì¼
  ```

- **SC-4.2**: íŒ¨ìŠ¤ì›Œë“œ ì •ì±… (í–¥í›„ êµ¬í˜„)
  ```
  ìµœì†Œ ê¸¸ì´: 8ì
  ì¡°í•©: ì˜ë¬¸ + ìˆ«ì + íŠ¹ìˆ˜ë¬¸ì
  í•´ì‹œ: BCrypt (cost 10)
  ```

- **SC-4.3**: Rate Limiting
  ```
  API: 100 req/min per IP
  WebSocket: 60 msg/min per connection
  ```

#### SC-5: ë°ì´í„° ì œì•½ì‚¬í•­
- **SC-5.1**: ë°ì´í„° í¬ê¸° ì œí•œ
  ```
  í”Œë ˆì´ì–´ëª…: ìµœëŒ€ 20ì
  ì ìˆ˜: ìµœëŒ€ 999,999,999
  ë ˆë²¨: ìµœëŒ€ 999
  ```

- **SC-5.2**: ë°ì´í„° ë³´ê´€ ê¸°ê°„
  ```
  ê²Œì„ ê¸°ë¡: ì˜êµ¬
  ì ‘ì† ë¡œê·¸: 30ì¼
  ì—ëŸ¬ ë¡œê·¸: 90ì¼
  ì„¸ì…˜ ë°ì´í„°: 24ì‹œê°„
  ```

- **SC-5.3**: ë°ì´í„°ë² ì´ìŠ¤ ìš©ëŸ‰
  ```
  ì´ˆê¸°: 10GB
  í™•ì¥: í•„ìš” ì‹œ 100GBê¹Œì§€
  ë°±ì—…: ì¼ì¼ í’€ ë°±ì—… (ì••ì¶•)
  ```

#### SC-6: ê°œë°œ ì œì•½ì‚¬í•­
- **SC-6.1**: ì½”ë“œ ìŠ¤íƒ€ì¼
  ```
  í¬ë§·í„°: Google Java Style Guide
  Indent: 4 spaces
  Line Length: 120ì
  ```

- **SC-6.2**: Git ë¸Œëœì¹˜ ì „ëµ
  ```
  main: í”„ë¡œë•ì…˜
  develop: ê°œë°œ
  feature/*: ê¸°ëŠ¥ ê°œë°œ
  hotfix/*: ê¸´ê¸‰ ìˆ˜ì •
  ```

- **SC-6.3**: ì½”ë“œ ë¦¬ë·°
  ```
  í•„ìˆ˜: PR ìŠ¹ì¸ 1ëª… ì´ìƒ
  ìë™ ê²€ì‚¬: SonarQube
  ì»¤ë²„ë¦¬ì§€: 80% ì´ìƒ ìœ ì§€
  ```

#### SC-7: ë°°í¬ ì œì•½ì‚¬í•­
- **SC-7.1**: ë°°í¬ í™˜ê²½
  ```
  ê°œë°œ: localhost
  ìŠ¤í…Œì´ì§•: staging.tetris.com
  í”„ë¡œë•ì…˜: tetris.com
  ```

- **SC-7.2**: ë°°í¬ ì£¼ê¸°
  ```
  íŒ¨ì¹˜: ì£¼ 1íšŒ (í™”ìš”ì¼)
  ë§ˆì´ë„ˆ: ì›” 1íšŒ (ì²«ì§¸ ì£¼)
  ë©”ì´ì €: ë¶„ê¸° 1íšŒ
  ```

- **SC-7.3**: ë¡¤ë°± ì •ì±…
  ```
  ìë™ ë¡¤ë°±: ì—ëŸ¬ìœ¨ 5% ì´ˆê³¼ ì‹œ
  ìˆ˜ë™ ë¡¤ë°±: ì¤‘ëŒ€ ë²„ê·¸ ë°œê²¬ ì‹œ
  ë¡¤ë°± ì‹œê°„: 5ë¶„ ì´ë‚´
  ```

---

## 2. ë³€ê²½ íŒŒì¼ ëª©ë¡ (Change List)

### 2.1 tetris-core ëª¨ë“ˆ

#### ìˆ˜ì • íŒŒì¼
```
tetris-core/src/main/java/seoultech/se/core/
â”œâ”€â”€ GameEngine.java                          [REFACTOR] Static â†’ Interface
â”‚   - public interface GameEngine
â”‚   - GameState lockTetromino(GameState state)
â”‚   - GameState tryMoveLeft/Right(GameState state)
â”‚   - GameState tryRotate(GameState state, RotationDirection dir)
â”‚   - GameState hardDrop(GameState state)
â”‚
â”œâ”€â”€ ClassicGameEngine.java                   [NEW] Classic êµ¬í˜„
â”‚   - @Component
â”‚   - implements GameEngine
â”‚   - í‘œì¤€ í…ŒíŠ¸ë¦¬ìŠ¤ ë¡œì§
â”‚
â”œâ”€â”€ ArcadeGameEngine.java                    [NEW] Arcade êµ¬í˜„
â”‚   - @Component @Primary
â”‚   - implements GameEngine
â”‚   - ì•„ì´í…œ ë¡œì§ ì¶”ê°€
â”‚
â”œâ”€â”€ GameState.java                           [REFACTOR] Mutable â†’ Immutable
â”‚   - @Value @Builder(toBuilder = true)
â”‚   - private final int score, level, ...
â”‚   - public GameState withScore(int newScore) {...}
â”‚   - public GameState withLevel(int newLevel) {...}
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ GameConfig.java                      [NEW] @ConfigurationProperties
â”‚   â”‚   - @ConfigurationProperties("tetris.game")
â”‚   â”‚   - int boardWidth, boardHeight
â”‚   â”‚   - boolean srsEnabled
â”‚   â”‚   - Difficulty difficulty
â”‚   â”‚
â”‚   â””â”€â”€ ItemConfig.java                      [MODIFY] @ConfigurationProperties
â”‚       - @ConfigurationProperties("tetris.game.item")
â”‚       - boolean enabled
â”‚       - double dropRate
â”‚       - List<ItemType> enabledItems
â”‚
â”œâ”€â”€ exception/                               [NEW] ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°
â”‚   â”œâ”€â”€ TetrisException.java                [NEW] extends RuntimeException
â”‚   â”œâ”€â”€ NetworkException.java               [NEW] extends TetrisException
â”‚   â”œâ”€â”€ ValidationException.java            [NEW] extends TetrisException
â”‚   â”œâ”€â”€ StateConflictException.java         [NEW] extends TetrisException
â”‚   â””â”€â”€ CheatDetectedException.java         [NEW] extends TetrisException
â”‚
â””â”€â”€ item/
    â”œâ”€â”€ ItemManager.java                     [NO CHANGE]
    â””â”€â”€ ItemSystem.java                      [OPTIONAL] ItemManager ë˜í¼
```

#### ì¤‘ìš” ë³€ê²½ì‚¬í•­
```java
// ============================================================
// 1. GameEngine Interface ë„ì…
// ============================================================

// âœ… Interface ì •ì˜
public interface GameEngine {
    GameState lockTetromino(GameState state);
    GameState tryMoveLeft(GameState state);
    GameState tryMoveRight(GameState state);
    GameState tryRotate(GameState state, RotationDirection dir);
    GameState hardDrop(GameState state);
    GameState softDrop(GameState state);
    GameState hold(GameState state);
}

// âœ… Classic êµ¬í˜„
@Component
@ConditionalOnProperty(name = "tetris.game.item.enabled", havingValue = "false")
public class ClassicGameEngine implements GameEngine {
    
    @Override
    public GameState lockTetromino(GameState state) {
        // ê¸°ì¡´ static ë©”ì„œë“œ ë¡œì§ ì´ë™
        GameState locked = state.toBuilder().build();
        locked = checkAndClearLines(locked);
        return locked;
    }
    
    @Override
    public GameState tryMoveLeft(GameState state) {
        // ê¸°ì¡´ ë¡œì§
    }
    
    // ... ë‚˜ë¨¸ì§€ ë©”ì„œë“œ êµ¬í˜„
}

// âœ… Arcade êµ¬í˜„
@Component
@Primary
@ConditionalOnProperty(name = "tetris.game.item.enabled", havingValue = "true")
public class ArcadeGameEngine implements GameEngine {
    
    private final ItemManager itemManager;
    
    @Autowired
    public ArcadeGameEngine(ItemManager itemManager) {
        this.itemManager = itemManager;
    }
    
    @Override
    public GameState lockTetromino(GameState state) {
        // Classic ë¡œì§
        GameState locked = super.lockTetromino(state);
        
        // ì•„ì´í…œ ì²˜ë¦¬ ì¶”ê°€
        locked = itemManager.processItems(locked);
        
        return locked;
    }
    
    // ... ë‚˜ë¨¸ì§€ ë©”ì„œë“œ êµ¬í˜„
}

// ============================================================
// 2. GameState ë¶ˆë³€ ê°ì²´ë¡œ ë³€ê²½
// ============================================================

// âœ… ë¶ˆë³€ ê°ì²´
@Value
@Builder(toBuilder = true)
public class GameState {
    // finalë¡œ ë³€ê²½
    private final int score;
    private final int level;
    private final int lines;
    private final Tetromino currentTetromino;
    private final int[][] grid;
    private final List<Tetromino> nextPieces;
    private final Tetromino holdPiece;
    
    // Metadata
    private final int lastLinesCleared;
    private final boolean lastLockWasTSpin;
    private final boolean lastLockWasTSpinMini;
    private final boolean lastIsPerfectClear;
    private final int comboCount;
    private final int backToBackCount;
    
    // Multiplayer
    private final int lastProcessedSequence;
    
    // âœ… ìƒíƒœ ë³€ê²½ ë©”ì„œë“œ (ìƒˆ ê°ì²´ ìƒì„±)
    public GameState withScore(int newScore) {
        return this.toBuilder().score(newScore).build();
    }
    
    public GameState withLevel(int newLevel) {
        return this.toBuilder().level(newLevel).build();
    }
    
    public GameState withCurrentTetromino(Tetromino tetromino) {
        return this.toBuilder().currentTetromino(tetromino).build();
    }
    
    // âœ… Grid ë³µì‚¬ (ê¹Šì€ ë³µì‚¬)
    public GameState withGrid(int[][] newGrid) {
        int[][] copiedGrid = new int[newGrid.length][];
        for (int i = 0; i < newGrid.length; i++) {
            copiedGrid[i] = Arrays.copyOf(newGrid[i], newGrid[i].length);
        }
        return this.toBuilder().grid(copiedGrid).build();
    }
    
    // âœ… ë³µì‚¬ ë©”ì„œë“œ
    public GameState copy() {
        return this.toBuilder()
            .grid(deepCopyGrid(this.grid))
            .nextPieces(new ArrayList<>(this.nextPieces))
            .build();
    }
    
    private int[][] deepCopyGrid(int[][] original) {
        int[][] copy = new int[original.length][];
        for (int i = 0; i < original.length; i++) {
            copy[i] = Arrays.copyOf(original[i], original[i].length);
        }
        return copy;
    }
}

// ============================================================
// 3. ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°
// ============================================================

// âœ… ìµœìƒìœ„ ì˜ˆì™¸
public class TetrisException extends RuntimeException {
    private final ErrorCode errorCode;
    
    public TetrisException(ErrorCode errorCode, String message) {
        super(message);
        this.errorCode = errorCode;
    }
    
    public TetrisException(ErrorCode errorCode, String message, Throwable cause) {
        super(message, cause);
        this.errorCode = errorCode;
    }
    
    public ErrorCode getErrorCode() {
        return errorCode;
    }
}

// âœ… ë„¤íŠ¸ì›Œí¬ ì˜ˆì™¸
public class NetworkException extends TetrisException {
    public NetworkException(String message) {
        super(ErrorCode.NETWORK_TIMEOUT, message);
    }
    
    public NetworkException(String message, Throwable cause) {
        super(ErrorCode.NETWORK_TIMEOUT, message, cause);
    }
}

// âœ… ê²€ì¦ ì˜ˆì™¸
public class ValidationException extends TetrisException {
    public ValidationException(String message) {
        super(ErrorCode.INVALID_COMMAND, message);
    }
}

// âœ… ìƒíƒœ ë¶ˆì¼ì¹˜ ì˜ˆì™¸
public class StateConflictException extends TetrisException {
    private final GameState serverState;
    
    public StateConflictException(String message, GameState serverState) {
        super(ErrorCode.STATE_CONFLICT, message);
        this.serverState = serverState;
    }
    
    public GameState getServerState() {
        return serverState;
    }
}
```

---

### 2.2 tetris-client ëª¨ë“ˆ

#### ì‹ ê·œ ìƒì„± íŒŒì¼
```
tetris-client/src/main/java/seoultech/se/client/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ GameEngineConfig.java               [NEW] GameEngine Bean ë“±ë¡
â”‚   â”‚   - @Configuration
â”‚   â”‚   - @Bean GameEngine (Classic/Arcade ì¡°ê±´ë¶€ ìƒì„±)
â”‚   â”‚
â”‚   â”œâ”€â”€ GameModeConfig.java                 [NEW] PlayTypeStrategy Bean ë“±ë¡
â”‚   â”‚   - @Configuration
â”‚   â”‚   - @Bean PlayTypeStrategy (Single/Multi ì¡°ê±´ë¶€ ìƒì„±)
â”‚   â”‚
â”‚   â”œâ”€â”€ NetworkConfig.java                  [NEW] NetworkService + Proxy
â”‚   â”‚   - @Configuration
â”‚   â”‚   - @Bean NetworkService
â”‚   â”‚   - @Bean NetworkServiceProxy (@Primary)
â”‚   â”‚
â”‚   â””â”€â”€ TetrisGameConfig.java               [NEW] @ConfigurationProperties
â”‚       - @ConfigurationProperties("tetris")
â”‚       - PlayType playType
â”‚       - NetworkSettings network
â”‚       - GameSettings game
â”‚
â”œâ”€â”€ strategy/
â”‚   â”œâ”€â”€ PlayTypeStrategy.java               [NEW] Strategy ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   - void onLineClear(GameState state)
â”‚   â”‚   - boolean beforeCommand(GameCommand command)
â”‚   â”‚   - void afterCommand(GameCommand command, GameState result)
â”‚   â”‚   - void onServerStateUpdate(GameState serverState)
â”‚   â”‚   - void onAttackReceived(int lines, String fromPlayerId)
â”‚   â”‚   - void initialize()
â”‚   â”‚   - void cleanup()
â”‚   â”‚   - PlayType getType()
â”‚   â”‚
â”‚   â”œâ”€â”€ SinglePlayStrategy.java             [NEW] Single êµ¬í˜„
â”‚   â”‚   - @Component
â”‚   â”‚   - implements PlayTypeStrategy
â”‚   â”‚   - beforeCommand() â†’ always return true
â”‚   â”‚   - afterCommand() â†’ no-op
â”‚   â”‚
â”‚   â””â”€â”€ MultiPlayStrategy.java              [CRITICAL] AtomicInteger ì‚¬ìš©
â”‚       - @Component
â”‚       - implements PlayTypeStrategy
â”‚       - AtomicInteger sequenceNumber  â† Thread-safe
â”‚       - ConcurrentHashMap<Integer, PendingCommand> pendingCommands
â”‚       - beforeCommand() â†’ ì„œë²„ ì „ì†¡ + íì‰
â”‚       - afterCommand() â†’ ì˜ˆì¸¡ ì €ì¥
â”‚       - onServerStateUpdate() â†’ Reconciliation
â”‚
â”œâ”€â”€ proxy/
â”‚   â””â”€â”€ NetworkServiceProxy.java            [CRITICAL] ì¬ì—°ê²° + í ì œí•œ
â”‚       - @Service @Primary
â”‚       - implements NetworkService
â”‚       - AtomicBoolean connected  â† Thread-safe
â”‚       - ConcurrentLinkedQueue<Object> offlineQueue
â”‚       - ScheduledExecutorService reconnectScheduler
â”‚       - MAX_QUEUE_SIZE = 1000  â† í¬ê¸° ì œí•œ
â”‚       - startReconnectTask()  â† 5ì´ˆ ê°„ê²© ì¬ì—°ê²°
â”‚       - flushOfflineQueue()  â† ì¬ì—°ê²° ì‹œ Flush
â”‚
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ NetworkService.java                 [NEW] ë„¤íŠ¸ì›Œí¬ í†µì‹  ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   - void sendCommand(GameCommand command)
â”‚   â”‚   - void sendAttack(int attackLines)
â”‚   â”‚   - void ping()  â† ì¬ì—°ê²°ìš©
â”‚   â”‚
â”‚   â””â”€â”€ NetworkServiceImpl.java             [NEW] ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ í†µì‹ 
â”‚       - @Service
â”‚       - implements NetworkService
â”‚       - RestTemplate restTemplate
â”‚       - WebSocketClient webSocketClient
â”‚
â”œâ”€â”€ event/
â”‚   â”œâ”€â”€ UIEvent.java                        [NEW] UI ì´ë²¤íŠ¸ DTO
â”‚   â”‚   - @Data @Builder
â”‚   â”‚   - UIEventType type
â”‚   â”‚   - Map<String, Object> data
â”‚   â”‚   - int priority
â”‚   â”‚   - long duration (ms)
â”‚   â”‚   - long timestamp
â”‚   â”‚   - int sequenceId
â”‚   â”‚
â”‚   â”œâ”€â”€ UIEventHandler.java                 [CRITICAL] AtomicBoolean + synchronized
â”‚   â”‚   - @Component
â”‚   â”‚   - AtomicBoolean isProcessing  â† Thread-safe
â”‚   â”‚   - PriorityQueue<UIEvent> eventQueue
â”‚   â”‚   - Object lock = new Object()  â† synchronizedìš©
â”‚   â”‚   - ScheduledExecutorService scheduler
â”‚   â”‚   - void handleEvents(List<UIEvent>) â† synchronized
â”‚   â”‚   - void processNextEvent() â† CAS íŒ¨í„´
â”‚   â”‚
â”‚   â””â”€â”€ LocalUIEventGenerator.java          [NEW] Local Event ìƒì„±
â”‚       - @Component
â”‚       - UIEvent generateLocalEvent(GameCommand, GameState)
â”‚       - BLOCK_MOVE, BLOCK_ROTATE, BLOCK_LOCK ìƒì„±
â”‚
â”œâ”€â”€ exception/
â”‚   â”œâ”€â”€ NetworkException.java               [NEW] ë„¤íŠ¸ì›Œí¬ ì˜ˆì™¸
â”‚   â”‚   - extends TetrisException
â”‚   â”‚
â”‚   â””â”€â”€ GlobalExceptionHandler.java         [NEW] @ControllerAdvice
â”‚       - @ControllerAdvice
â”‚       - @ExceptionHandler(NetworkException.class)
â”‚       - @ExceptionHandler(StateConflictException.class)
â”‚       - @ExceptionHandler(ValidationException.class)
â”‚       - ErrorResponse handleException(Exception)
â”‚
â”œâ”€â”€ security/                               [NEW] ë³´ì•ˆ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java        [NEW] JWT í•„í„°
â”‚   â”‚   - extends OncePerRequestFilter
â”‚   â”‚   - doFilterInternal() â† JWT ê²€ì¦
â”‚   â”‚
â”‚   â””â”€â”€ RateLimitingInterceptor.java        [NEW] Rate Limiting
â”‚       - implements HandlerInterceptor
â”‚       - ConcurrentHashMap<String, RateLimiter> limiters
â”‚       - preHandle() â† Rate Limit ì²´í¬
â”‚
â”œâ”€â”€ monitoring/                             [NEW] ëª¨ë‹ˆí„°ë§
â”‚   â”œâ”€â”€ GameMetrics.java                    [NEW] Micrometer ë©”íŠ¸ë¦­
â”‚   â”‚   - @Component
â”‚   â”‚   - MeterRegistry registry
â”‚   â”‚   - recordCommand(String type, long duration)
â”‚   â”‚   - recordStateConflict()
â”‚   â”‚   - setActivePlayers(int count)
â”‚   â”‚
â”‚   â””â”€â”€ PerformanceLoggingAspect.java       [NEW] @Measured AOP
â”‚       - @Aspect @Component
â”‚       - @Around("@annotation(Measured)")
â”‚       - 100ms ì´ìƒ ê±¸ë¦¬ë©´ WARN ë¡œê·¸
â”‚
â””â”€â”€ dto/
    â”œâ”€â”€ GameCommand.java                    [NEW] Command DTO
    â”‚   - @Data @Builder
    â”‚   - CommandType commandType
    â”‚   - int sequenceNumber
    â”‚   - String playerId
    â”‚   - Map<String, Object> data
    â”‚
    â”œâ”€â”€ GameUpdateResponse.java             [NEW] Response DTO
    â”‚   - @Data @Builder
    â”‚   - boolean success
    â”‚   - int sequenceNumber
    â”‚   - long timestamp
    â”‚   - GameState state
    â”‚   - List<UIEvent> events
    â”‚
    â”œâ”€â”€ ErrorResponse.java                  [NEW] ì—ëŸ¬ ì‘ë‹µ DTO
    â”‚   - @Data @Builder
    â”‚   - int code
    â”‚   - String message
    â”‚   - long timestamp
    â”‚   - String path
    â”‚
    â””â”€â”€ AttackEvent.java                    [NEW] ê³µê²© ì´ë²¤íŠ¸ DTO
        - @Data @Builder
        - int attackLines
        - String fromPlayerId
        - String toPlayerId
        - long timestamp
```

#### ìˆ˜ì • íŒŒì¼ (CRITICAL)
```
tetris-client/src/main/java/seoultech/se/client/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ BoardController.java                [MAJOR REFACTOR]
â”‚       
â”‚       ì£¼ìš” ë³€ê²½ì‚¬í•­:
â”‚       1. GameEngineì„ DIë¡œ ì£¼ì… (Interface)
â”‚       2. PlayTypeStrategyë¥¼ DIë¡œ ì£¼ì…
â”‚       3. UIEventHandlerë¥¼ DIë¡œ ì£¼ì…
â”‚       4. LocalUIEventGeneratorë¥¼ DIë¡œ ì£¼ì…
â”‚       
â”‚       ì¶”ê°€ ë©”ì„œë“œ:
â”‚       - forceStateUpdate(GameState serverState)
â”‚       - handleNetworkError(NetworkException e)
â”‚       
â”‚       ë³€ê²½ ë©”ì„œë“œ:
â”‚       - executeCommand(GameCommand command)
â”‚         â†’ beforeCommand() í˜¸ì¶œ ì¶”ê°€
â”‚         â†’ Local Event ìƒì„± ì¶”ê°€
â”‚         â†’ afterCommand() í˜¸ì¶œ ì¶”ê°€
â”‚       
â”‚       - onServerUpdate(GameUpdateResponse response)
â”‚         â†’ onServerStateUpdate() í˜¸ì¶œ ì¶”ê°€
â”‚         â†’ Critical Events ì²˜ë¦¬ ì¶”ê°€
â”‚       
â””â”€â”€ mode/
    â”œâ”€â”€ PlayType.java                        [MOVE] tetris-coreì—ì„œ ì´ë™
    â”‚   - enum PlayType { LOCAL_SINGLE, ONLINE_MULTI }
    â”‚
    â””â”€â”€ GameplayType.java                    [NEW] Axis 2 ì •ì˜
        - enum GameplayType { CLASSIC, ARCADE }
```

---

### 2.3 tetris-backend ëª¨ë“ˆ

#### ì‹ ê·œ ìƒì„± íŒŒì¼
```
tetris-backend/src/main/java/seoultech/se/backend/
â”œâ”€â”€ game/
â”‚   â”œâ”€â”€ GameService.java                    [NEW] ê²Œì„ ë¡œì§ ì„œë¹„ìŠ¤
â”‚   â”‚   - @Service
â”‚   â”‚   - GameUpdateResponse processCommand(GameCommand)
â”‚   â”‚   - GameState loadGameState(String playerId)
â”‚   â”‚   - void saveGameState(String playerId, GameState state)
â”‚   â”‚
â”‚   â”œâ”€â”€ CriticalEventGenerator.java         [CRITICAL] AtomicInteger ì‚¬ìš©
â”‚   â”‚   - @Component
â”‚   â”‚   - AtomicInteger eventSequenceId  â† Thread-safe
â”‚   â”‚   - List<UIEvent> generate(GameState old, GameState new)
â”‚   â”‚   - generateLineClearEvent()
â”‚   â”‚   - generateTSpinEvent()
â”‚   â”‚   - generateComboEvent()
â”‚   â”‚   - generateLevelUpEvent()
â”‚   â”‚
â”‚   â”œâ”€â”€ GameStateStore.java                 [NEW] ê²Œì„ ìƒíƒœ ì €ì¥ì†Œ
â”‚   â”‚   - @Component
â”‚   â”‚   - ConcurrentHashMap<String, GameState> states
â”‚   â”‚   - GameState get(String playerId)
â”‚   â”‚   - void save(String playerId, GameState state)
â”‚   â”‚   - void remove(String playerId)
â”‚   â”‚
â”‚   â””â”€â”€ CheatDetectionService.java          [NEW] ì¹˜íŒ… ê²€ì¦
â”‚       - @Service
â”‚       - void validateCommand(GameCommand, GameState)
â”‚       - void validateScoreIncrease(GameState old, GameState new)
â”‚       - void validateLineClearSpeed(GameState old, GameState new)
â”‚       - ConcurrentHashMap<String, ViolationCount> violations
â”‚
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ GameController.java                 [NEW] REST API ì—”ë“œí¬ì¸íŠ¸
â”‚       - @RestController @RequestMapping("/api/game")
â”‚       - @PostMapping("/command") processCommand()
â”‚       - @GetMapping("/state") getGameState()
â”‚       - @PostMapping("/attack") sendAttack()
â”‚
â”œâ”€â”€ security/
â”‚   â”œâ”€â”€ JwtUtil.java                        [NEW] JWT ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   - @Component
â”‚   â”‚   - String generateToken(String playerId)
â”‚   â”‚   - String getPlayerId(String token)
â”‚   â”‚   - boolean validateToken(String token)
â”‚   â”‚
â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java        [NEW] JWT í•„í„°
â”‚   â”‚   - extends OncePerRequestFilter
â”‚   â”‚   - doFilterInternal() â† JWT ê²€ì¦
â”‚   â”‚
â”‚   â””â”€â”€ SecurityConfig.java                 [NEW] Spring Security ì„¤ì •
â”‚       - @Configuration @EnableWebSecurity
â”‚       - SecurityFilterChain filterChain()
â”‚       - /api/auth/** permit all
â”‚       - /api/game/** authenticated
â”‚
â”œâ”€â”€ exception/
â”‚   â”œâ”€â”€ GlobalExceptionHandler.java         [NEW] @RestControllerAdvice
â”‚   â”‚   - @RestControllerAdvice
â”‚   â”‚   - @ExceptionHandler(...)
â”‚   â”‚   - ErrorResponse handleException()
â”‚   â”‚
â”‚   â””â”€â”€ ErrorCode.java                      [NEW] ì—ëŸ¬ ì½”ë“œ Enum
â”‚       - enum ErrorCode {
â”‚           INVALID_COMMAND(400),
â”‚           NETWORK_TIMEOUT(408),
â”‚           STATE_CONFLICT(409),
â”‚           TOO_MANY_REQUESTS(429),
â”‚           INTERNAL_ERROR(500),
â”‚           SERVICE_UNAVAILABLE(503)
â”‚         }
â”‚
â””â”€â”€ websocket/
    â””â”€â”€ GameWebSocketHandler.java           [NEW] WebSocket í•¸ë“¤ëŸ¬
        - @Component
        - implements WebSocketHandler
        - onOpen(), onMessage(), onClose()
        - broadcast(UIEvent event)
```

---

## 3. ì•„í‚¤í…ì²˜ ì„¤ê³„ (Architecture)

### 3.1 í•µì‹¬ ì„¤ê³„ ì›ì¹™

#### ì›ì¹™ 1: ë‘ ì¶• ëª…í™•íˆ ë¶„ë¦¬ (Composition)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BoardController                        â”‚
â”‚                   (Orchestrator)                        â”‚
â”‚                                                         â”‚
â”‚  executeCommand(GameCommand command) {                 â”‚
â”‚    try {                                               â”‚
â”‚      // Axis 1: PlayType (Single/Multi)               â”‚
â”‚      boolean shouldExecute =                           â”‚
â”‚        playTypeStrategy.beforeCommand(command);        â”‚ â† ì„œë²„ ì „ì†¡ (Multië§Œ)
â”‚                                                         â”‚
â”‚      if (!shouldExecute) return;                       â”‚
â”‚                                                         â”‚
â”‚      // Local Event ìƒì„± (ì¦‰ì‹œ í”¼ë“œë°±)                    â”‚
â”‚      UIEvent localEvent =                              â”‚
â”‚        localEventGen.generateLocalEvent(command);      â”‚
â”‚      eventHandler.handle(localEvent);                  â”‚ â† ì¦‰ì‹œ í‘œì‹œ
â”‚                                                         â”‚
â”‚      // Axis 2: GameplayType (Classic/Arcade)         â”‚
â”‚      GameState newState =                              â”‚
â”‚        gameEngine.execute(command, currentState);      â”‚ â† ë¡œì»¬ ì˜ˆì¸¡
â”‚                                                         â”‚
â”‚      // Axis 1: ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥                          â”‚
â”‚      playTypeStrategy.afterCommand(command, newState); â”‚ â† Multi: íì‰
â”‚                                                         â”‚
â”‚      // ìƒíƒœ ì—…ë°ì´íŠ¸                                    â”‚
â”‚      this.currentState = newState;                     â”‚
â”‚      renderState(newState);                            â”‚
â”‚                                                         â”‚
â”‚    } catch (NetworkException e) {                     â”‚
â”‚      handleNetworkError(e);  // ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì „í™˜       â”‚
â”‚    } catch (ValidationException e) {                  â”‚
â”‚      showErrorMessage(e.getMessage());                 â”‚
â”‚    }                                                    â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  onServerUpdate(GameUpdateResponse response) {         â”‚
â”‚    // Axis 1: State Reconciliation                    â”‚
â”‚    playTypeStrategy.onServerStateUpdate(              â”‚
â”‚      response.getState()                              â”‚
â”‚    );                                                   â”‚ â† Mismatch ê°ì§€ + ë™ê¸°í™”
â”‚                                                         â”‚
â”‚    // Critical Events ì²˜ë¦¬                             â”‚
â”‚    if (!response.getEvents().isEmpty()) {              â”‚
â”‚      eventHandler.handleEvents(response.getEvents());  â”‚ â† ìˆœì°¨ í‘œì‹œ
â”‚    }                                                    â”‚
â”‚                                                         â”‚
â”‚    // ìƒíƒœ ì—…ë°ì´íŠ¸                                      â”‚
â”‚    this.currentState = response.getState();            â”‚
â”‚    renderState(currentState);                          â”‚
â”‚  }                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â”‚ Axis 2                 â”‚ Axis 1
            â”‚ (Gameplay)             â”‚ (PlayType)
            â–¼                        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   GameEngine    â”‚      â”‚ PlayTypeStrategyâ”‚
   â”‚  (Interface)    â”‚      â”‚  (Interface)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚        â”‚                 â”‚
     â–¼             â–¼        â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚Classic  â”‚  â”‚ Arcade  â”‚  â”‚Singleâ”‚     â”‚Multi â”‚
â”‚Engine   â”‚  â”‚ Engine  â”‚  â”‚Play  â”‚     â”‚Play  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
```

**ì„¤ê³„ ì˜ë„**:
- **ë‘ ì¶• ë…ë¦½ì„±**: PlayTypeê³¼ GameplayTypeì„ ì™„ì „íˆ ë¶„ë¦¬
- **ì¡°í•© ê°€ëŠ¥**: 2 x 2 = 4ê°€ì§€ ì¡°í•© ìë™ ì§€ì›
- **í™•ì¥ ìš©ì´**: ìƒˆ PlayType ë˜ëŠ” GameplayType ì¶”ê°€ ì‹œ ë‹¤ë¥¸ ì¶• ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”

---

#### ì›ì¹™ 2: Server Authoritative + Cheating Detection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚                    â”‚   Server    â”‚
â”‚             â”‚                    â”‚             â”‚
â”‚  1. Input   â”‚â”€â”€sendCommand()â”€â”€â”€â”€â†’â”‚ 2. JWT ê²€ì¦ â”‚
â”‚     â†“       â”‚  + JWT Token       â”‚  & Rate     â”‚
â”‚  2. Local   â”‚                    â”‚  Limiting   â”‚
â”‚  Prediction â”‚                    â”‚     â†“       â”‚
â”‚     â†“       â”‚                    â”‚ 3. Command  â”‚
â”‚  3. Render  â”‚                    â”‚  Validation â”‚
â”‚  (ì¦‰ì‹œ)     â”‚                    â”‚     â†“       â”‚
â”‚             â”‚                    â”‚ 4. Execute  â”‚
â”‚             â”‚                    â”‚  GameEngine â”‚
â”‚             â”‚                    â”‚     â†“       â”‚
â”‚             â”‚                    â”‚ 5. Cheat    â”‚
â”‚             â”‚                    â”‚  Detection  â”‚
â”‚             â”‚                    â”‚     â†“       â”‚
â”‚  4. Receive â”‚â†â”€â”€GameState +â”€â”€â”€â”€â”€â”€â”‚ 6. Generate â”‚
â”‚     â†“       â”‚   Events[]         â”‚  Events     â”‚
â”‚  5. Recon-  â”‚                    â”‚     â†“       â”‚
â”‚  ciliation  â”‚                    â”‚ 7. Save     â”‚
â”‚     â†“       â”‚                    â”‚  State      â”‚
â”‚  6. Render  â”‚                    â”‚     â†“       â”‚
â”‚  (ë³´ì •)     â”‚                    â”‚ 8. Broadcastâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì„¤ê³„ ì˜ë„**:
- **Server Authoritative**: ì„œë²„ ì‘ë‹µì´ ìµœì¢… ì§„ì‹¤
- **Client-Side Prediction**: ë„¤íŠ¸ì›Œí¬ ì§€ì—° ìˆ¨ê¸°ê¸°
- **Cheating Detection**: ì„œë²„ì—ì„œ ëª¨ë“  ë¡œì§ ì¬ì‹¤í–‰ + ê²€ì¦
- **State Reconciliation**: ë¶ˆì¼ì¹˜ ì‹œ ì„œë²„ ìƒíƒœë¡œ ë™ê¸°í™”

---

#### ì›ì¹™ 3: ë™ì‹œì„± ì•ˆì •ì„± (Thread-safe)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UIEventHandler                           â”‚
â”‚                                                        â”‚
â”‚  âœ… Thread-safe ë³€ìˆ˜                                   â”‚
â”‚  private final AtomicBoolean isProcessing;  â†â”€â”€â”€â”€â”   â”‚
â”‚  private final PriorityQueue<UIEvent> eventQueue;â”‚   â”‚
â”‚  private final Object lock = new Object();  â†â”€â”€â”€â”€â”¤   â”‚
â”‚                                                   â”‚   â”‚
â”‚  public void handleEvents(List<UIEvent> events) { â”‚   â”‚
â”‚    // 1. Queue ì ‘ê·¼ì€ synchronized                â”‚   â”‚
â”‚    synchronized (lock) {  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      eventQueue.addAll(events);                      â”‚
â”‚    }                                                  â”‚
â”‚                                                        â”‚
â”‚    // 2. CAS íŒ¨í„´ìœ¼ë¡œ ì›ìì  ìƒíƒœ ë³€ê²½                  â”‚
â”‚    if (isProcessing.compareAndSet(false, true)) {  â† CAS
â”‚      processNextEvent();                              â”‚
â”‚    }                                                  â”‚
â”‚  }                                                     â”‚
â”‚                                                        â”‚
â”‚  private void processNextEvent() {                    â”‚
â”‚    UIEvent event;                                     â”‚
â”‚    synchronized (lock) {  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚      event = eventQueue.poll();                  â”‚   â”‚
â”‚      if (event == null) {                        â”‚   â”‚
â”‚        isProcessing.set(false);  â† Atomic       â”‚   â”‚
â”‚        return;                                   â”‚   â”‚
â”‚      }                                           â”‚   â”‚
â”‚    }  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â”‚    displayEvent(event);                               â”‚
â”‚                                                        â”‚
â”‚    scheduler.schedule(                                â”‚
â”‚      this::processNextEvent,                          â”‚
â”‚      event.getDuration(),                             â”‚
â”‚      TimeUnit.MILLISECONDS                            â”‚
â”‚    );                                                  â”‚
â”‚  }                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì„¤ê³„ ì˜ë„**:
- **AtomicBoolean**: CAS íŒ¨í„´ìœ¼ë¡œ Race Condition ë°©ì§€
- **synchronized**: Queue ì ‘ê·¼ ì‹œ ë™ê¸°í™”
- **Lock ìµœì†Œí™”**: Critical Section ìµœì†Œí™”ë¡œ ì„±ëŠ¥ ìœ ì§€

---

### 3.2 ì‹¤í–‰ íë¦„

#### íë¦„ 1: ë©€í‹°í”Œë ˆì´ì–´ Command ì „ì†¡ ë° ì²˜ë¦¬ (ë‹¨ìˆœ ì´ë™)

```
[Client ì¸¡]

1. User Input (LEFT í‚¤ ëˆ„ë¦„)
   â”‚
   â–¼
2. BoardController.handleMoveLeft()
   â”‚
   â–¼
3. GameCommand command = GameCommand.builder()
     .commandType(CommandType.MOVE_LEFT)
     .build();
   â”‚
   â–¼
4. âœ… playTypeStrategy.beforeCommand(command)
   â”‚
   â”œâ”€ Single: return true (ë¡œì»¬ë§Œ ì‹¤í–‰)
   â”‚
   â””â”€ Multi:
      â”œâ”€ command.setSequenceNumber(sequenceNumber.getAndIncrement())  â† AtomicInteger
      â”œâ”€ networkService.sendCommand(command)  â† ì„œë²„ ì „ì†¡
      â”œâ”€ pendingCommands.put(seq, command)  â† íì‰
      â””â”€ return true  â† ë¡œì»¬ ì˜ˆì¸¡ í—ˆìš©
   â”‚
   â–¼
5. âœ… localEventGen.generateLocalEvent(command, gameState)
   â”‚  â†’ UIEvent {type: BLOCK_MOVE, duration: 50ms}
   â”‚
   â–¼
6. âœ… eventHandler.handle(localEvent)  â† ì¦‰ì‹œ í‘œì‹œ âš¡ (<50ms)
   â”‚
   â–¼
7. gameEngine.tryMoveLeft(gameState)  â† Local Prediction
   â”‚  â†’ newState = state.withCurrentTetromino(moved)
   â”‚
   â–¼
8. âœ… playTypeStrategy.afterCommand(command, newState)
   â”‚
   â”œâ”€ Single: (ì•„ë¬´ê²ƒë„ ì•ˆ í•¨)
   â”‚
   â””â”€ Multi: 
      â””â”€ predictedStates.put(seq, newState)  â† ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥
   â”‚
   â–¼
9. this.gameState = newState;
   renderState(newState);  â† UI ì—…ë°ì´íŠ¸

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Server ì¸¡] (ë¹„ë™ê¸°)

10. Server receives POST /api/game/command
    Body: {
      "commandType": "MOVE_LEFT",
      "sequenceNumber": 42,
      "playerId": "player123"
    }
    â”‚
    â–¼
11. JwtAuthenticationFilter: JWT ê²€ì¦ âœ…
    â”‚
    â–¼
12. RateLimitingInterceptor: Rate Limit ì²´í¬ âœ…
    â”‚
    â–¼
13. GameController.processCommand(command)
    â”‚
    â–¼
14. GameService.processCommand(command)
    â”‚
    â”œâ”€ GameState oldState = stateStore.get("player123")
    â”‚
    â”œâ”€ GameState newState = gameEngine.tryMoveLeft(oldState)
    â”‚
    â”œâ”€ newState.setLastProcessedSequence(42)
    â”‚
    â”œâ”€ stateStore.save("player123", newState)
    â”‚
    â””â”€ List<UIEvent> events = []  â† ë‹¨ìˆœ ì´ë™ì€ Critical Event ì—†ìŒ
    â”‚
    â–¼
15. return GameUpdateResponse {
      success: true,
      sequenceNumber: 42,
      timestamp: 1730899200050,
      state: newState,
      events: []
    }

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Client ì¸¡] (ì„œë²„ ì‘ë‹µ ìˆ˜ì‹ )

16. onServerUpdate(response)
    â”‚
    â–¼
17. âœ… playTypeStrategy.onServerStateUpdate(response.getState())
    â”‚
    â””â”€ Multi:
       â”œâ”€ int serverSeq = serverState.getLastProcessedSequence()  // 42
       â”‚
       â”œâ”€ PredictedState predicted = predictedStates.get(42)
       â”‚
       â”œâ”€ if (statesMatch(predicted.state, serverState)) {
       â”‚    // âœ… ì˜ˆì¸¡ ì„±ê³µ! ë³´ì • ë¶ˆí•„ìš”
       â”‚    System.out.println("âœ… Prediction correct");
       â”‚  } else {
       â”‚    // âŒ ì˜ˆì¸¡ ì‹¤íŒ¨! ì„œë²„ ìƒíƒœë¡œ ê°•ì œ ë™ê¸°í™”
       â”‚    System.err.println("âŒ Prediction mismatch!");
       â”‚    boardController.forceStateUpdate(serverState);
       â”‚  }
       â”‚
       â””â”€ pendingCommands.keySet().removeIf(seq -> seq <= 42)  â† ì²˜ë¦¬ëœ Command ì œê±°
    â”‚
    â–¼
18. this.gameState = response.getState();
    renderState(gameState);  â† í•„ìš”ì‹œ UI ì—…ë°ì´íŠ¸

ì™„ë£Œ! (ì „ì²´ ì‹œê°„: ~150ms)
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- **ì¦‰ì‹œ ë°˜ì‘**: Local Event í‘œì‹œ (<50ms)
- **ì˜ˆì¸¡ ì •í™•ì„±**: ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì˜ˆì¸¡ ì„±ê³µ (ë³´ì • ë¶ˆí•„ìš”)
- **ë„¤íŠ¸ì›Œí¬ ì§€ì—°**: ìˆ¨ê²¨ì§ (ì‚¬ìš©ìëŠ” ëŠë¼ì§€ ëª»í•¨)

---

## 3.5 ì»´í¬ë„ŒíŠ¸ ë° ì¸í„°í˜ì´ìŠ¤ ëª…ì„¸

### 3.5.1 tetris-core ëª¨ë“ˆ ì»´í¬ë„ŒíŠ¸

#### A. GameEngine (ê²Œì„ ì—”ì§„)

**ì—­í• **: í…ŒíŠ¸ë¦¬ìŠ¤ ê²Œì„ì˜ í•µì‹¬ ë¡œì§ ì²˜ë¦¬

**ì£¼ìš” ë©”ì„œë“œ**:
```java
public class GameEngine {
    /**
     * ê²Œì„ ì—”ì§„ ì´ˆê¸°í™”
     * @param config ê²Œì„ ëª¨ë“œ ì„¤ì •
     */
    public void initialize(GameModeConfig config)
    
    /**
     * í…ŒíŠ¸ë¡œë¯¸ë…¸ë¥¼ ì™¼ìª½ìœ¼ë¡œ ì´ë™
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @return ì—…ë°ì´íŠ¸ëœ ê²Œì„ ìƒíƒœ
     */
    public GameState tryMoveLeft(GameState state)
    
    /**
     * í…ŒíŠ¸ë¡œë¯¸ë…¸ë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @return ì—…ë°ì´íŠ¸ëœ ê²Œì„ ìƒíƒœ
     */
    public GameState tryMoveRight(GameState state)
    
    /**
     * í…ŒíŠ¸ë¡œë¯¸ë…¸ íšŒì „
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @param direction íšŒì „ ë°©í–¥ (CW/CCW)
     * @return ì—…ë°ì´íŠ¸ëœ ê²Œì„ ìƒíƒœ
     */
    public GameState tryRotate(GameState state, RotationDirection direction)
    
    /**
     * í•˜ë“œ ë“œë¡­ (ì¦‰ì‹œ ë°”ë‹¥ê¹Œì§€)
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @return ì—…ë°ì´íŠ¸ëœ ê²Œì„ ìƒíƒœ (ë¸”ë¡ ê³ ì •ë¨)
     */
    public GameState hardDrop(GameState state)
    
    /**
     * í™€ë“œ ê¸°ëŠ¥
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @return ì—…ë°ì´íŠ¸ëœ ê²Œì„ ìƒíƒœ
     */
    public GameState hold(GameState state)
    
    /**
     * ë¸”ë¡ ê³ ì • ë° ë¼ì¸ í´ë¦¬ì–´ ì²˜ë¦¬
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @return ì—…ë°ì´íŠ¸ëœ ê²Œì„ ìƒíƒœ (ì ìˆ˜, ë ˆë²¨ ê³„ì‚° ì™„ë£Œ)
     */
    public GameState lockTetromino(GameState state)
    
    /**
     * T-Spin ê°ì§€
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @param tetromino í…ŒíŠ¸ë¡œë¯¸ë…¸
     * @return T-Spin ì—¬ë¶€ ë° Mini ì—¬ë¶€
     */
    private TSpinResult detectTSpin(GameState state, Tetromino tetromino)
}
```

**ì˜ì¡´ì„±**:
- ItemManager (ì•„ì¼€ì´ë“œ ëª¨ë“œì—ì„œ ì‚¬ìš©)
- GameModeConfig

---

#### B. GameState (ê²Œì„ ìƒíƒœ)

**ì—­í• **: ê²Œì„ì˜ ëª¨ë“  ìƒíƒœ ì •ë³´ë¥¼ ë¶ˆë³€ ê°ì²´ë¡œ ê´€ë¦¬

**ì£¼ìš” í•„ë“œ**:
```java
@Data
public class GameState {
    // ë³´ë“œ ì •ë³´
    private final int boardWidth;
    private final int boardHeight;
    private final Cell[][] grid;
    
    // í˜„ì¬ í…ŒíŠ¸ë¡œë¯¸ë…¸
    private Tetromino currentTetromino;
    private int currentX;
    private int currentY;
    private ItemType currentItemType;  // ì•„ì¼€ì´ë“œ ëª¨ë“œ
    
    // Hold & Next
    private boolean holdUsedThisTurn;
    private TetrominoType heldPiece;
    private TetrominoType[] nextQueue;
    
    // ê²Œì„ í†µê³„
    private long score;
    private int linesCleared;
    private int level;
    private int linesForNextLevel;
    private boolean isGameOver;
    private String gameOverReason;
    
    // ì½¤ë³´ & ë°±íˆ¬ë°±
    private int comboCount;
    private boolean lastActionClearedLines;
    private int backToBackCount;
    private boolean lastClearWasDifficult;
    
    // Lock Delay
    private boolean isLockDelayActive;
    private int lockDelayResets;
    
    // ê²Œì„ ìƒíƒœ
    private boolean isPaused;
    
    // T-Spin ë©”íƒ€ë°ì´í„°
    private boolean lastActionWasRotation;
    private int lastRotationKickIndex;
    private boolean lastLockWasTSpin;
    private boolean lastLockWasTSpinMini;
    
    // Lock ë©”íƒ€ë°ì´í„° (ì´ë²¤íŠ¸ ìƒì„±ìš©)
    private Tetromino lastLockedTetromino;
    private int lastLockedX;
    private int lastLockedY;
    private int lastLinesCleared;
    private int[] lastClearedRows;
    private long lastScoreEarned;
    private boolean lastIsPerfectClear;
    private boolean lastLeveledUp;
    
    /**
     * ìƒì„±ì
     */
    public GameState(int width, int height)
    
    /**
     * ê·¸ë¦¬ë“œ ë³µì‚¬ (ê¹Šì€ ë³µì‚¬)
     */
    public Cell[][] copyGrid()
    
    /**
     * ì™„ì „í•œ ìƒíƒœ ë³µì‚¬
     */
    public GameState copy()
}
```

**íŠ¹ì§•**:
- ë¶ˆë³€ ê°ì²´ íŒ¨í„´ (ëª¨ë“  í•„ë“œ final)
- Builder íŒ¨í„´ ì§€ì›
- Thread-safe

---

#### C. GameMode (ì¸í„°í˜ì´ìŠ¤ - Strategy Pattern)

**ì—­í• **: ê²Œì„ ëª¨ë“œë³„ ì¶”ê°€ ë¡œì§ì„ ì •ì˜í•˜ëŠ” ì „ëµ ì¸í„°í˜ì´ìŠ¤

**ì¸í„°í˜ì´ìŠ¤ ì •ì˜**:
```java
public interface GameMode {
    /**
     * ëª¨ë“œ íƒ€ì… ë°˜í™˜
     */
    GameModeType getType();
    
    /**
     * ê²Œì„ ëª¨ë“œ ì´ˆê¸°í™”
     * @param state ì´ˆê¸° ê²Œì„ ìƒíƒœ
     */
    void initialize(GameState state);
    
    /**
     * ë¼ì¸ í´ë¦¬ì–´ í›„ ì¶”ê°€ ì²˜ë¦¬
     * @param state ë¼ì¸ í´ë¦¬ì–´ í›„ ìƒíƒœ
     * @param linesCleared ì§€ì›Œì§„ ë¼ì¸ ìˆ˜
     * @return ëª¨ë“œë³„ ì¶”ê°€ ì²˜ë¦¬ê°€ ë°˜ì˜ëœ ìƒíƒœ
     */
    GameState onLineClear(GameState state, int linesCleared);
    
    /**
     * ë¸”ë¡ ê³ ì • í›„ ì¶”ê°€ ì²˜ë¦¬
     * @param state ë¸”ë¡ ê³ ì • í›„ ìƒíƒœ
     * @return ëª¨ë“œë³„ ì¶”ê°€ ì²˜ë¦¬ê°€ ë°˜ì˜ëœ ìƒíƒœ
     */
    GameState onBlockLock(GameState state);
    
    /**
     * ì»¤ë§¨ë“œ ì‹¤í–‰ ê°€ëŠ¥ ì—¬ë¶€ ê²€ì¦
     * @param command ì‹¤í–‰í•˜ë ¤ëŠ” ì»¤ë§¨ë“œ
     * @param state í˜„ì¬ ìƒíƒœ
     * @return ì‹¤í–‰ ê°€ëŠ¥ ì—¬ë¶€
     */
    boolean canExecuteCommand(GameCommand command, GameState state);
    
    /**
     * ê²Œì„ ëª¨ë“œ ì„¤ì • ë°˜í™˜
     */
    GameModeConfig getConfig();
    
    /**
     * ê²Œì„ ëª¨ë“œ ì„¤ì • ë³€ê²½
     */
    void setConfig(GameModeConfig config);
    
    /**
     * ë¦¬ì†ŒìŠ¤ ì •ë¦¬
     */
    void cleanup();
}
```

**êµ¬í˜„ í´ë˜ìŠ¤**:
- `SingleMode`: ì‹±ê¸€ í”Œë ˆì´ ëª¨ë“œ
- `MultiMode`: ë©€í‹° í”Œë ˆì´ ëª¨ë“œ (ë¯¸êµ¬í˜„)

---

#### D. ItemManager (ì•„ì´í…œ ê´€ë¦¬ì)

**ì—­í• **: ì•„ì¼€ì´ë“œ ëª¨ë“œì˜ ì•„ì´í…œ ìƒì„± ë° ê´€ë¦¬

**ì£¼ìš” ë©”ì„œë“œ**:
```java
public class ItemManager {
    /**
     * ì•„ì´í…œ ë“œë¡­ (í™•ë¥  ê¸°ë°˜)
     * @return ìƒì„±ëœ ì•„ì´í…œ íƒ€ì… (nullì´ë©´ ì¼ë°˜ ë¸”ë¡)
     */
    public ItemType generateItemDrop()
    
    /**
     * ì•„ì´í…œ ì‚¬ìš©
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     * @param itemType ì‚¬ìš©í•  ì•„ì´í…œ íƒ€ì…
     * @return ì•„ì´í…œ íš¨ê³¼ê°€ ì ìš©ëœ ê²Œì„ ìƒíƒœ
     */
    public GameState useItem(GameState state, ItemType itemType)
    
    /**
     * ì•„ì´í…œ í™œì„±í™” ì„¤ì •
     * @param itemTypes í™œì„±í™”í•  ì•„ì´í…œ íƒ€ì… ëª©ë¡
     */
    public void setEnabledItems(Set<ItemType> itemTypes)
    
    /**
     * ì•„ì´í…œ ë“œë¡­ í™•ë¥  ì„¤ì •
     * @param dropRate ë“œë¡­ í™•ë¥  (0.0 ~ 0.3) - ìµœëŒ€ 30% ì œí•œ
     * @throws IllegalArgumentException dropRateê°€ 0.3 ì´ˆê³¼ ì‹œ
     */
    public void setItemDropRate(double dropRate)
}
```

**ì§€ì› ì•„ì´í…œ**:
- `BOMB_ITEM`: í­íƒ„ (ë¼ì¸ ì‚­ì œ)
- `BONUS_SCORE_ITEM`: ë³´ë„ˆìŠ¤ ì ìˆ˜
- `SPEED_RESET_ITEM`: ë‚™í•˜ ì†ë„ ì´ˆê¸°í™”
- `PLUS_ITEM`: ì¶”ê°€ íš¨ê³¼

---

#### E. Command ì¸í„°í˜ì´ìŠ¤ ë° êµ¬í˜„

**Command ì¸í„°í˜ì´ìŠ¤**:
```java
public interface GameCommand {
    /**
     * ì»¤ë§¨ë“œ íƒ€ì… ë°˜í™˜
     */
    CommandType getType();
    
    /**
     * ì»¤ë§¨ë“œ ì„¤ëª… (ë””ë²„ê¹…ìš©)
     */
    default String getDescription() {
        return getType().toString();
    }
}
```

**êµ¬í˜„ í´ë˜ìŠ¤**:
```java
// ì´ë™ ì»¤ë§¨ë“œ
public class MoveCommand implements GameCommand {
    private final Direction direction;  // LEFT, RIGHT, DOWN
}

// íšŒì „ ì»¤ë§¨ë“œ
public class RotateCommand implements GameCommand {
    private final RotationDirection direction;  // CW, CCW
}

// í•˜ë“œ ë“œë¡­ ì»¤ë§¨ë“œ
public class HardDropCommand implements GameCommand {
}

// í™€ë“œ ì»¤ë§¨ë“œ
public class HoldCommand implements GameCommand {
}

// ì¼ì‹œì •ì§€/ì¬ê°œ ì»¤ë§¨ë“œ
public class PauseCommand implements GameCommand {
}

public class ResumeCommand implements GameCommand {
}
```

---

### 3.5.2 tetris-client ëª¨ë“ˆ ì»´í¬ë„ŒíŠ¸

#### A. BoardController (ê²Œì„ ì»¨íŠ¸ë¡¤ëŸ¬)

**ì—­í• **: ê²Œì„ ë¡œì§ê³¼ UI ì‚¬ì´ì˜ ì¤‘ì¬ì

**ì£¼ìš” ë©”ì„œë“œ**:
```java
@Component
public class BoardController {
    /**
     * ê²Œì„ ì‹œì‘
     */
    public void startGame()
    
    /**
     * ê²Œì„ ì¼ì‹œì •ì§€
     */
    public void pauseGame()
    
    /**
     * ê²Œì„ ì¬ê°œ
     */
    public void resumeGame()
    
    /**
     * ì»¤ë§¨ë“œ ì‹¤í–‰
     * @param command ì‹¤í–‰í•  ì»¤ë§¨ë“œ
     */
    public void executeCommand(GameCommand command)
    
    /**
     * ìë™ ë‚™í•˜ (íƒ€ì´ë¨¸ ê¸°ë°˜)
     */
    public void autoFall()
    
    /**
     * í˜„ì¬ ê²Œì„ ìƒíƒœ ë°˜í™˜
     */
    public GameState getGameState()
    
    /**
     * ê²Œì„ ëª¨ë“œ ì„¤ì •
     */
    public void setGameMode(GameMode gameMode)
    
    /**
     * ë‚œì´ë„ ì„¤ì •
     */
    public void setDifficulty(Difficulty difficulty)
}
```

**ì˜ì¡´ì„±**:
- GameEngine
- GameMode
- RandomGenerator
- TetrominoGenerator

---

#### B. BoardRenderer (ë³´ë“œ ë Œë”ëŸ¬)

**ì—­í• **: GameStateë¥¼ JavaFX UIë¡œ ë Œë”ë§

**ì£¼ìš” ë©”ì„œë“œ**:
```java
public class BoardRenderer {
    /**
     * ê²Œì„ ìƒíƒœ ë Œë”ë§
     * @param state ë Œë”ë§í•  ê²Œì„ ìƒíƒœ
     */
    public void render(GameState state)
    
    /**
     * ì…€ ì—…ë°ì´íŠ¸
     * @param row í–‰
     * @param col ì—´
     * @param cell ì…€ ì •ë³´
     */
    public void updateCell(int row, int col, Cell cell)
    
    /**
     * Hold ì˜ì—­ ë Œë”ë§
     * @param tetrominoType í™€ë“œëœ í…ŒíŠ¸ë¡œë¯¸ë…¸ íƒ€ì…
     */
    public void renderHold(TetrominoType tetrominoType)
    
    /**
     * Next ì˜ì—­ ë Œë”ë§
     * @param nextQueue ë‹¤ìŒ í…ŒíŠ¸ë¡œë¯¸ë…¸ í
     */
    public void renderNext(TetrominoType[] nextQueue)
    
    /**
     * ê³ ìŠ¤íŠ¸ í”¼ìŠ¤ ë Œë”ë§
     * @param state í˜„ì¬ ê²Œì„ ìƒíƒœ
     */
    public void renderGhostPiece(GameState state)
}
```

---

#### C. InputHandler (ì…ë ¥ ì²˜ë¦¬ê¸°)

**ì—­í• **: í‚¤ë³´ë“œ ì…ë ¥ì„ GameCommandë¡œ ë³€í™˜

**ì£¼ìš” ë©”ì„œë“œ**:
```java
public class InputHandler {
    /**
     * í‚¤ ì…ë ¥ ì²˜ë¦¬
     * @param event JavaFX í‚¤ ì´ë²¤íŠ¸
     */
    public void handleKeyPress(KeyEvent event)
    
    /**
     * í‚¤ ë§¤í•‘ ì„¤ì •
     * @param action ê²Œì„ ì•¡ì…˜
     * @param keyCode í‚¤ ì½”ë“œ
     */
    public void setKeyMapping(GameAction action, KeyCode keyCode)
    
    /**
     * ì»¤ë§¨ë“œ ìƒì„±
     * @param action ê²Œì„ ì•¡ì…˜
     * @return ìƒì„±ëœ ì»¤ë§¨ë“œ
     */
    private GameCommand createCommand(GameAction action)
}
```

---

#### D. GameLoopManager (ê²Œì„ ë£¨í”„ ê´€ë¦¬ì)

**ì—­í• **: ê²Œì„ ë£¨í”„ ì‹¤í–‰ ë° íƒ€ì´ë° ê´€ë¦¬

**ì£¼ìš” ë©”ì„œë“œ**:
```java
public class GameLoopManager {
    /**
     * ê²Œì„ ë£¨í”„ ì‹œì‘
     */
    public void start()
    
    /**
     * ê²Œì„ ë£¨í”„ ì¤‘ì§€
     */
    public void stop()
    
    /**
     * í”„ë ˆì„ ì—…ë°ì´íŠ¸ (60 FPS)
     */
    private void update()
    
    /**
     * ìë™ ë‚™í•˜ íƒ€ì´ë¨¸
     */
    private void scheduleAutoFall()
}
```

---

#### E. SingleMode / MultiMode (í”Œë ˆì´ ëª¨ë“œ)

**SingleMode (ì‹±ê¸€ í”Œë ˆì´)**:
```java
@Component
public class SingleMode implements GameMode {
    @Override
    public GameModeType getType() {
        return GameModeType.SINGLE;
    }
    
    @Override
    public void initialize(GameState state) {
        // ë¡œì»¬ ê²Œì„ ì´ˆê¸°í™”
    }
    
    @Override
    public GameState onLineClear(GameState state, int linesCleared) {
        // ì¶”ê°€ ë¡œì§ ì—†ìŒ (ê¸°ë³¸ ì ìˆ˜ ê³„ì‚°ë§Œ)
        return state;
    }
    
    @Override
    public GameState onBlockLock(GameState state) {
        // ì•„ì´í…œ ë“œë¡­ ë“± ì²˜ë¦¬
        return state;
    }
    
    @Override
    public boolean canExecuteCommand(GameCommand command, GameState state) {
        return !state.isPaused();
    }
}
```

**MultiMode (ë©€í‹° í”Œë ˆì´ - ë¯¸êµ¬í˜„)**:
```java
@Component
public class MultiMode implements GameMode {
    private NetworkService networkService;
    
    @Override
    public GameModeType getType() {
        return GameModeType.MULTI;
    }
    
    @Override
    public void initialize(GameState state) {
        // ì„œë²„ ì—°ê²°
        networkService.connect();
    }
    
    @Override
    public GameState onLineClear(GameState state, int linesCleared) {
        // ê³µê²© ì „ì†¡
        networkService.sendAttack(calculateAttack(linesCleared));
        return state;
    }
    
    // ... ë‚˜ë¨¸ì§€ êµ¬í˜„
}
```

---

### 3.5.3 tetris-backend ëª¨ë“ˆ ì»´í¬ë„ŒíŠ¸

#### A. GameService (ê²Œì„ ì„œë¹„ìŠ¤)

**ì—­í• **: ê²Œì„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬ (í˜„ì¬ ë¯¸êµ¬í˜„, í–¥í›„ í™•ì¥)

**ì£¼ìš” ë©”ì„œë“œ**:
```java
@Service
public class GameService {
    /**
     * ì»¤ë§¨ë“œ ì²˜ë¦¬ (Server Authoritative)
     * @param command í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ ì»¤ë§¨ë“œ
     * @param playerId í”Œë ˆì´ì–´ ID
     * @return ì²˜ë¦¬ ê²°ê³¼ (ì—…ë°ì´íŠ¸ëœ GameState)
     */
    public GameUpdateResponse processCommand(GameCommand command, String playerId)
    
    /**
     * ê²Œì„ ì„¸ì…˜ ìƒì„±
     * @param playerId í”Œë ˆì´ì–´ ID
     * @return ìƒì„±ëœ ì„¸ì…˜ ID
     */
    public String createGameSession(String playerId)
    
    /**
     * ê²Œì„ ìƒíƒœ ì¡°íšŒ
     * @param sessionId ì„¸ì…˜ ID
     * @return ê²Œì„ ìƒíƒœ
     */
    public GameState getGameState(String sessionId)
    
    /**
     * ê³µê²© ì „ì†¡
     * @param fromPlayerId ê³µê²©ì ID
     * @param toPlayerId ëŒ€ìƒì ID
     * @param attackLines ê³µê²© ë¼ì¸ ìˆ˜
     */
    public void sendAttack(String fromPlayerId, String toPlayerId, int attackLines)
}
```

---

#### B. ScoreService (ì ìˆ˜ ì„œë¹„ìŠ¤)

**ì—­í• **: ì ìˆ˜ ì €ì¥ ë° ë­í‚¹ ì¡°íšŒ

**ì£¼ìš” ë©”ì„œë“œ**:
```java
@Service
public class ScoreService {
    /**
     * ì ìˆ˜ ì €ì¥
     * @param scoreRequest ì ìˆ˜ ì •ë³´
     * @return ì €ì¥ëœ ì ìˆ˜ ID
     */
    public Long saveScore(ScoreRequestDto scoreRequest)
    
    /**
     * ë­í‚¹ ì¡°íšŒ
     * @param gameMode ê²Œì„ ëª¨ë“œ
     * @param limit ì¡°íšŒ ê°œìˆ˜
     * @return ë­í‚¹ ëª©ë¡
     */
    public List<ScoreRankDto> getRanking(GameMode gameMode, int limit)
    
    /**
     * ê°œì¸ ìµœê³  ì ìˆ˜ ì¡°íšŒ
     * @param playerName í”Œë ˆì´ì–´ ì´ë¦„
     * @param gameMode ê²Œì„ ëª¨ë“œ
     * @return ìµœê³  ì ìˆ˜
     */
    public ScoreResponseDto getPersonalBest(String playerName, GameMode gameMode)
}
```

---

### 3.5.4 ì»´í¬ë„ŒíŠ¸ ê°„ ìƒí˜¸ì‘ìš©

#### ê²Œì„ ì‹¤í–‰ íë¦„

```
1. ì‚¬ìš©ì ì…ë ¥ (í‚¤ë³´ë“œ)
   â†“
2. InputHandler.handleKeyPress()
   â†“
3. GameCommand ìƒì„±
   â†“
4. BoardController.executeCommand()
   â†“
5. GameEngine.tryMoveLeft/tryRotate/... ()
   â†“
6. GameState ì—…ë°ì´íŠ¸ (ë¶ˆë³€ ê°ì²´ ë°˜í™˜)
   â†“
7. GameMode.onBlockLock() / onLineClear()
   â†“
8. BoardRenderer.render(newState)
   â†“
9. UI ì—…ë°ì´íŠ¸ (JavaFX)
```

#### ì•„ì´í…œ ì‚¬ìš© íë¦„ (ì•„ì¼€ì´ë“œ ëª¨ë“œ)

```
1. ì‚¬ìš©ìê°€ ì•„ì´í…œ ì‚¬ìš© í‚¤ ì…ë ¥
   â†“
2. InputHandler â†’ UseItemCommand ìƒì„±
   â†“
3. BoardController.executeCommand()
   â†“
4. ItemManager.useItem(state, itemType)
   â†“
5. Item.apply(state) ì‹¤í–‰
   â†“
6. GameState ì—…ë°ì´íŠ¸ (ì•„ì´í…œ íš¨ê³¼ ì ìš©)
   â†“
7. BoardRenderer.render(newState)
```

#### ë©€í‹°í”Œë ˆì´ì–´ ì»¤ë§¨ë“œ íë¦„ (í–¥í›„ êµ¬í˜„)

```
Client:
1. ì‚¬ìš©ì ì…ë ¥
   â†“
2. GameCommand ìƒì„±
   â†“
3. Client-Side Prediction (ë¡œì»¬ ì‹¤í–‰)
   â†“
4. NetworkService.sendCommand() â†’ ì„œë²„ ì „ì†¡
   â†“

Server:
5. GameService.processCommand()
   â†“
6. ì»¤ë§¨ë“œ ê²€ì¦ (Cheating Detection)
   â†“
7. GameEngine ì‹¤í–‰ (Server Authoritative)
   â†“
8. GameUpdateResponse ìƒì„±
   â†“
9. í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µ ì „ì†¡
   â†“

Client:
10. State Reconciliation (ì„œë²„ ìƒíƒœì™€ ë¹„êµ)
    â†“
11. í•„ìš”ì‹œ Pending Commands ì¬ì‹¤í–‰
    â†“
12. UI ì—…ë°ì´íŠ¸
```

---

### 3.5.5 í•µì‹¬ ë°ì´í„° êµ¬ì¡°

#### Tetromino (í…ŒíŠ¸ë¡œë¯¸ë…¸)

```java
public class Tetromino {
    private final TetrominoType type;  // I, O, T, S, Z, J, L
    private final int[][] shape;        // 2D ë°°ì—´ (4x4)
    private final RotationState rotation;  // 0, 90, 180, 270
    private final seoultech.se.core.model.enumType.Color color;
    
    /**
     * íšŒì „ëœ ìƒˆ í…ŒíŠ¸ë¡œë¯¸ë…¸ ë°˜í™˜
     */
    public Tetromino rotate(RotationDirection direction)
    
    /**
     * ì´ë™ëœ ìƒˆ í…ŒíŠ¸ë¡œë¯¸ë…¸ ë°˜í™˜
     */
    public Tetromino move(int dx, int dy)
}
```

#### Cell (ì…€)

```java
public class Cell {
    private boolean filled;  // ë¸”ë¡ì´ ìˆëŠ”ì§€
    private seoultech.se.core.model.enumType.Color color;  // ë¸”ë¡ ìƒ‰ìƒ
    private ItemType itemType;  // ì•„ì´í…œ íƒ€ì… (nullì´ë©´ ì¼ë°˜ ë¸”ë¡)
    
    /**
     * ë¹ˆ ì…€ ìƒì„±
     */
    public static Cell empty()
    
    /**
     * ì¼ë°˜ ë¸”ë¡ ì…€ ìƒì„±
     */
    public static Cell filled(seoultech.se.core.model.enumType.Color color)
    
    /**
     * ì•„ì´í…œ ë¸”ë¡ ì…€ ìƒì„±
     */
    public static Cell item(ItemType itemType, seoultech.se.core.model.enumType.Color color)
}
```

---

(ë¬¸ì„œ ê³„ì†...)
